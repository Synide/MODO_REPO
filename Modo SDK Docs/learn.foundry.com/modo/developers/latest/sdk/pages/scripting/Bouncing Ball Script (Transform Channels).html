

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->

<!-- Mirrored from learn.foundry.com/modo/developers/latest/sdk/pages/scripting/Bouncing Ball Script (Transform Channels).html by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 30 Nov 2024 03:16:00 GMT -->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Bouncing Ball Script (Transform Channels) &mdash; Modo SDK 14.2v0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/js/contentui.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="ChangeRenderFrameRange Script" href="ChangeRenderFrameRange%20Script.html" />
    <link rel="prev" title="AppleScript" href="AppleScript.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Modo SDK
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="https://learn.foundry.com/modo/developers/latest/sdk/search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Articles</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../starting/_starting.html">First Steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server_basics/_server_basics.html">Server Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general/_general.html">Editorial Info</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ui/_ui.html">User Interface</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="_scripting.html">Scripting</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="AppleScript.html">AppleScript</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Bouncing Ball Script (Transform Channels)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#transform-channels">Transform Channels</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#transform-items">Transform Items</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-transform-items">Creating Transform Items</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#bouncing-ball-example">Bouncing Ball Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#more-information">More Information</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ChangeRenderFrameRange%20Script.html">ChangeRenderFrameRange Script</a></li>
<li class="toctree-l2"><a class="reference internal" href="Layerservice.html">Layerservice</a></li>
<li class="toctree-l2"><a class="reference internal" href="Lua.html">Lua</a></li>
<li class="toctree-l2"><a class="reference internal" href="Macros.html">Macros</a></li>
<li class="toctree-l2"><a class="reference internal" href="Perl.html">Perl</a></li>
<li class="toctree-l2"><a class="reference internal" href="Script%20lua.html">Script lua</a></li>
<li class="toctree-l2"><a class="reference internal" href="ScriptQuery%20Interface%20701%20Updates.html">ScriptQuery Interface 701 Updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="ScriptQuery%20Overview.html">ScriptQuery Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="Scripting.html">Scripting</a></li>
<li class="toctree-l2"><a class="reference internal" href="Scripting%20Preview.html">Scripting Preview</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faqs/_faqs.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption"><span class="caption-text">Code Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/_tutorials.html">SDK Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/_examples.html">Code Examples and Snippets</a></li>
</ul>
<p class="caption"><span class="caption-text">Technical Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../python/python.html">Python Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cpp/cpp.html">C++ Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Modo SDK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="_scripting.html">Scripting</a> &raquo;</li>
        
      <li>Bouncing Ball Script (Transform Channels)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="bouncing-ball-script-transform-channels">
<h1>Bouncing Ball Script (Transform Channels)<a class="headerlink" href="#bouncing-ball-script-transform-channels" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#transform-channels" id="id1">Transform Channels</a></p>
<ul>
<li><p><a class="reference internal" href="#transform-items" id="id2">Transform Items</a></p></li>
<li><p><a class="reference internal" href="#creating-transform-items" id="id3">Creating Transform Items</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#bouncing-ball-example" id="id4">Bouncing Ball Example</a></p></li>
<li><p><a class="reference internal" href="#more-information" id="id5">More Information</a></p></li>
</ul>
</div>
<p>modo takes a somewhat unique approach to item transforms. Rather than include the transforms as part of the item itself, the item is linked to secondary transform-specific items.  This article explains how transform channels work and demonstrates them with script that creates a bouncing ball.</p>
<div class="section" id="transform-channels">
<h2><a class="toc-backref" href="#id1">Transform Channels</a><a class="headerlink" href="#transform-channels" title="Permalink to this headline">¶</a></h2>
<p>Every item in modo has channels, and these are the primary manner in which item state is exposed for editing. Some channels are hidden from the user, or represent [Common Datatypes#Complex Datatypes|complex datatypes]] such as mesh stacks and item links. In general, scripts deal only with <a class="reference internal" href="../general/general/Common%20Datatypes.html"><span class="doc">Common Datatypes</span></a>, notably numeric and string channels.</p>
<p>As described previously, most item channels can be walked through the sceneservice]] [[ScriptQuery Overview command. Transform channels, however, are a little different.</p>
<div class="section" id="transform-items">
<h3><a class="toc-backref" href="#id2">Transform Items</a><a class="headerlink" href="#transform-items" title="Permalink to this headline">¶</a></h3>
<p>Locator item types (which includes ‘’Mesh’’, ‘’Camera’’, <em>Light</em> and so on) do not directly have their own position, rotation and scale channels. Instead, they have links to transform items that handle these properties. This allows multiple items to share the same transform items, and to save memory by not creating the transform items and associated channels when they aren?t required.</p>
<p>This unique system complicates how the position, rotation and scale of an item are read. You can?t directly ask the item for its channels, since they aren’t on that item.  Instead, you must ask the item for its transform item, and then query that item’s channels. The <em>sceneservice</em> ScriptQuery interface provides a series of <em>item.xfrm???</em> attributes to simplify getting the IDs of the transform items.</p>
<p>These each require an item ID as a selector, which can be obtained via the <em>item.id</em> attribute of ‘’sceneservice’’. The <em>item.xfrmItems</em> attribute returns a list of all transform items currently used by the selector item. For example, a mesh item might return the following:</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="n">scale021</span>
 <span class="n">rotation022</span>
 <span class="n">translation023</span>
</pre></div>
</td></tr></table></div>
<p>You can also directly request a transform item by using one of the other <em>item.xfrm???</em> attributes. These simply return the item ID string, or an empty string if there is no linked transform item.</p>
<p>As you can see from the table above, there are currently five types of transform items. The position, rotation and scale transforms should be obvious. Pivot defines a “pivot point”, which defines the position at which the rotation transform is centered. Pivot compensation is the inverse of the pivot transform; when you move the pivot of an item that has been scaled or rotated, a compensation transform is calculated to ensure that the item remains in the same wold position.</p>
</div>
<div class="section" id="creating-transform-items">
<h3><a class="toc-backref" href="#id3">Creating Transform Items</a><a class="headerlink" href="#creating-transform-items" title="Permalink to this headline">¶</a></h3>
<p>If the transform you want to manipulate does not yet have a matching item, you need to create it first. This example shows how to check for the pivot transform item, and if it is not found, create it through the transform.add command.</p>
<div class="content-tabs docutils container">
<div class="tab-content docutils container" id="tab-perl">
<p class="tab-title">Perl</p>
<div class="highlight-perl notranslate"><div class="highlight"><pre><span></span><span class="k">my</span> <span class="nv">$itemID</span> <span class="o">=</span> <span class="n">myItemID</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$pivotID</span> <span class="o">=</span> <span class="n">lxq</span><span class="p">(</span> <span class="s">&quot;query sceneservice item.xfrmPiv ? $itemID&quot;</span> <span class="p">);</span>
<span class="n">lxout</span><span class="p">(</span> <span class="s">&quot;pivot = $pivotID&quot;</span> <span class="p">);</span>
<span class="k">if</span><span class="p">(</span> <span class="nv">$pivotID</span> <span class="ow">eq</span> <span class="s">&quot;&quot;</span> <span class="p">)</span> <span class="p">{</span>
    <span class="c1"># Pivot item does not exist; create it</span>
    <span class="n">lx</span><span class="p">(</span> <span class="s">&quot;transform.add type:piv&quot;</span> <span class="p">);</span>
    <span class="nv">$pivotID</span> <span class="o">=</span> <span class="n">lxq</span> <span class="p">(</span><span class="s">&quot;query sceneservice item.xfrmPiv ? $itemID&quot;</span> <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="tab-content docutils container" id="tab-lua">
<p class="tab-title">Lua</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">itemID</span> <span class="o">=</span> <span class="n">myItemID</span>
<span class="n">pivotID</span> <span class="o">=</span> <span class="n">lxq</span><span class="p">(</span> <span class="s2">&quot;query sceneservice item.xfrmPiv ? &quot;</span> <span class="o">..</span> <span class="n">itemID</span> <span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">lxout</span><span class="p">(</span> <span class="s2">&quot;pivot = &quot;</span> <span class="o">..</span> <span class="n">pivotID</span> <span class="p">);</span>
<span class="kr">if</span> <span class="n">pivotID</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="kr">then</span>
    <span class="c1">-- Pivot item does not exist; create it</span>
    <span class="n">lx</span><span class="p">(</span> <span class="s2">&quot;transform.add type:piv&quot;</span> <span class="p">)</span>
    <span class="n">pivotID</span> <span class="o">=</span> <span class="n">lxq</span><span class="p">(</span> <span class="s2">&quot;query sceneservice item.xfrmPiv ? &quot;</span> <span class="o">..</span> <span class="n">iitemID</span> <span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="kr">end</span>
</pre></div>
</div>
</div>
<div class="tab-content docutils container" id="tab-python">
<p class="tab-title">Python</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">itemID</span> <span class="o">=</span> <span class="n">myItemID</span>
<span class="n">pivotID</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">eval1</span><span class="p">(</span> <span class="s2">&quot;query sceneservice item.xfrmPiv ? &quot;</span> <span class="o">+</span> <span class="n">itemID</span> <span class="p">)</span>
<span class="n">lx</span><span class="o">.</span><span class="n">out</span><span class="p">(</span> <span class="s2">&quot;pivot = &quot;</span><span class="p">,</span> <span class="n">itemID</span> <span class="p">)</span>
<span class="k">if</span> <span class="n">pivotID</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="p">:</span>
    <span class="c1"># Pivot item does not exist; create it</span>
    <span class="n">lx</span><span class="o">.</span><span class="n">command</span><span class="p">(</span> <span class="s2">&quot;transform.add&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;piv&quot;</span> <span class="p">)</span>
    <span class="n">pivotID</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">eval1</span> <span class="p">(</span><span class="s2">&quot;query sceneservice item.xfrmPiv ? &quot;</span> <span class="o">+</span> <span class="n">itemID</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Once you have the item ID, you can query it as normal through the item.channel command or through the sceneservice interface. Since item.channel works on the current item selection, you need to select the transform item first with select.item, or you can pass it as the item argument. This example sets the X position of the pivot item to 1.3 meters.</p>
<div class="content-tabs docutils container">
<div class="tab-content docutils container" id="tab-perl">
<p class="tab-title">Perl</p>
<div class="highlight-perl notranslate"><div class="highlight"><pre><span></span><span class="n">lx</span><span class="p">(</span> <span class="s">&quot;item.channel pos.X 1.3 {$pivotID}&quot;</span> <span class="p">);</span>
</pre></div>
</div>
</div>
<div class="tab-content docutils container" id="tab-lua">
<p class="tab-title">Lua</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="n">lx</span><span class="p">(</span> <span class="s2">&quot;item.channel pos.X 1.3 &quot;</span> <span class="o">..</span><span class="n">pivotID</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="tab-content docutils container" id="tab-python">
<p class="tab-title">Python</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lx</span><span class="o">.</span><span class="n">command</span><span class="p">(</span> <span class="s2">&quot;item.channel&quot;</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="s2">&quot;pos.X&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;1.3&quot;</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">pivotID</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="bouncing-ball-example">
<h2><a class="toc-backref" href="#id4">Bouncing Ball Example</a><a class="headerlink" href="#bouncing-ball-example" title="Permalink to this headline">¶</a></h2>
<p>This example perl script by Arnie Cachelin creates a simple bouncing ball style animation by creating keyframes on the position transform item of the currently selected item.</p>
<div class="content-tabs docutils container">
<div class="tab-content docutils container" id="tab-perl">
<p class="tab-title">Perl</p>
<div class="highlight-perl notranslate"><div class="highlight"><pre><span></span><span class="c1"># perl -- Bouncer.pl</span>
<span class="c1"># Arnie Cachelin, Luxology LLC, Copyright 2007-2008</span>
<span class="c1"># A Simple Dynamics Script -- Physics 101 equations of</span>
<span class="c1"># motion in one dimension</span>

<span class="c1"># This version specializes in the trajectory of a dropped or</span>
<span class="c1"># launched object which bounces.</span>
<span class="c1"># To use this, select the object which is already at the time</span>
<span class="c1"># and place at its motion should start.</span>


<span class="c1"># User Input animation parameters</span>
<span class="k">my</span> <span class="nv">$v0</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>           <span class="c1"># initial speed (m/s)</span>
<span class="k">my</span> <span class="nv">$time</span> <span class="o">=</span> <span class="mf">11.0</span><span class="p">;</span>    <span class="c1"># length of simulation (in seconds)</span>
<span class="k">my</span> <span class="nv">$ymin</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>     <span class="c1"># ground/wall position, where bounces would occur (m)</span>
<span class="k">my</span> <span class="nv">$elastic</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">;</span>  <span class="c1"># elasticity: percent energy kept per bounce</span>
<span class="k">my</span> <span class="nv">$fstep</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">;</span>    <span class="c1"># number of frames between keys</span>

<span class="c1"># physical constants</span>
<span class="k">my</span> <span class="nv">$g</span><span class="o">=</span><span class="mf">9.8</span><span class="p">;</span>          <span class="c1"># gravity on earth = 9.8 m/s^2 DOWN</span>
<span class="k">my</span> <span class="nv">$a</span><span class="o">=-</span><span class="nv">$g</span><span class="p">;</span>          <span class="c1"># accleration (m/s^2) negative, since UP is positive</span>

<span class="c1">#lxtrace(1);         # Use this for debugging</span>

<span class="c1"># get selected locator-type item</span>
<span class="k">my</span> <span class="nv">$item</span> <span class="o">=</span> <span class="n">lxq</span><span class="p">(</span> <span class="s">&quot;query sceneservice selection ? locator&quot;</span> <span class="p">);</span>

<span class="c1"># get its position transform item</span>
<span class="k">my</span> <span class="nv">$xfrm</span> <span class="o">=</span> <span class="n">lxq</span> <span class="p">(</span><span class="s">&quot;query sceneservice item.xfrmPos ? $item&quot;</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$xfrm</span> <span class="ow">eq</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1"># Position transform item does not exist; create it</span>
    <span class="n">lx</span> <span class="p">(</span><span class="s">&quot;transform.add type:pos&quot;</span><span class="p">);</span>
    <span class="nv">$xfrm</span> <span class="o">=</span> <span class="n">lxq</span> <span class="p">(</span><span class="s">&quot;query sceneservice item.xfrmPiv ? $item&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1"># select the item in sceneservice for subsequent channel queries</span>
<span class="k">my</span> <span class="nv">$xnm</span> <span class="o">=</span> <span class="n">lxq</span> <span class="p">(</span><span class="s">&quot;query sceneservice item.name ? $xfrm&quot;</span><span class="p">);</span>

<span class="k">my</span> <span class="nv">$chan</span> <span class="o">=</span> <span class="n">lxq</span> <span class="p">(</span><span class="s">&quot;query sceneservice channel.index ?  pos.Y&quot;</span><span class="p">);</span><span class="o">.</span>
<span class="k">my</span> <span class="nv">$tf</span> <span class="o">=</span> <span class="n">lxq</span> <span class="p">(</span><span class="s">&quot;time.range scene out:?&quot;</span><span class="p">);</span>
<span class="nv">$ti</span> <span class="o">=</span> <span class="n">lxq</span> <span class="p">(</span><span class="s">&quot;select.time ?&quot;</span><span class="p">);</span>     <span class="c1"># starting time: Now!</span>
<span class="k">my</span> <span class="nv">$time</span> <span class="o">=</span> <span class="nv">$tf</span> <span class="o">-</span> <span class="nv">$ti</span><span class="p">;</span>            <span class="c1"># final time</span>
<span class="k">my</span> <span class="nv">$val</span> <span class="o">=</span> <span class="n">lxq</span> <span class="p">(</span><span class="s">&quot;query sceneservice channel.value ? $chan&quot;</span><span class="p">);</span>
<span class="k">my</span> <span class="nv">$fps</span> <span class="o">=</span> <span class="n">lxq</span> <span class="p">(</span><span class="s">&quot;time.fpsCustom ?&quot;</span><span class="p">);</span>
<span class="k">my</span> <span class="nv">$dt</span> <span class="o">=</span> <span class="nv">$fstep</span> <span class="o">/</span> <span class="nv">$fps</span><span class="p">;</span>          <span class="c1"># add keys every other frame</span>
<span class="k">my</span> <span class="nv">$nf</span> <span class="o">=</span> <span class="nv">$time</span> <span class="o">*</span> <span class="nv">$fps</span> <span class="o">/</span> <span class="nv">$fstep</span><span class="p">;</span>  <span class="c1"># number of frames</span>

<span class="k">my</span> <span class="nv">$y0</span> <span class="o">=</span> <span class="nv">$val</span> <span class="o">-</span> <span class="nv">$ymin</span><span class="p">;</span>           <span class="c1"># initial position</span>

<span class="c1">#lxout (&quot;Time = $time ( $nf frames at $fps fps ) from $ti s to $tf s by $dt s&quot;);    # Use this for debugging</span>


<span class="c1"># calculation section, where plenty of other important things are derived from the inputs</span>

<span class="c1"># maximum height reached, (where vtop==0)</span>
<span class="k">my</span> <span class="nv">$ytop</span> <span class="o">=</span> <span class="p">((</span><span class="mf">0.5</span> <span class="o">*</span> <span class="nv">$v0</span> <span class="o">*</span> <span class="nv">$v0</span><span class="p">)</span><span class="o">/</span><span class="nv">$g</span><span class="p">)</span> <span class="o">+</span> <span class="nv">$y0</span><span class="p">;</span>

<span class="c1"># time to reach ytop from y0</span>
<span class="k">my</span> <span class="nv">$ttop</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$v0</span><span class="p">)</span><span class="o">/</span><span class="nv">$g</span><span class="p">;</span>

<span class="c1"># time to hit ground from ytop</span>
<span class="k">my</span> <span class="nv">$tbounce</span> <span class="o">=</span> <span class="nb">sqrt</span> <span class="p">((</span><span class="nv">$ttop</span> <span class="o">*</span> <span class="nv">$ttop</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="nv">$y0</span> <span class="o">/</span> <span class="nv">$g</span><span class="p">);</span>

<span class="c1"># speed at bounce, deduced from energy conservation</span>
<span class="k">my</span> <span class="nv">$vbounce</span> <span class="o">=</span> <span class="nb">sqrt</span> <span class="p">((</span><span class="nv">$v0</span><span class="o">*</span><span class="nv">$v0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="nv">$g</span><span class="o">*</span><span class="nv">$y0</span><span class="p">);</span>

<span class="c1">#lxout (&quot;Top at: $ttop s ($ytop m) Bounces $tbounce s later&quot;);</span>


<span class="c1"># add initial key at current time</span>
<span class="n">lx</span> <span class="p">(</span><span class="s">&quot;channel.key mode:add channel:{$xfrm:$chan}&quot;</span><span class="p">);</span>
<span class="n">lx</span> <span class="p">(</span><span class="s">&quot;select.channel mode:set channel:{$xfrm:$chan}&quot;</span><span class="p">);</span>
<span class="n">lx</span> <span class="p">(</span><span class="s">&quot;channel.interpolation linear&quot;</span><span class="p">);</span>
<span class="n">lx</span> <span class="p">(</span><span class="s">&quot;channel.value mode:set value:{$val}&quot;</span><span class="p">);</span>

<span class="k">my</span> <span class="nv">$tscene</span> <span class="o">=</span> <span class="nv">$ti</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$tt</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$y</span><span class="p">;</span>

<span class="c1"># time of next bounce relative to t0</span>
<span class="k">my</span> <span class="nv">$tb</span> <span class="o">=</span> <span class="nv">$ttop</span> <span class="o">+</span> <span class="nv">$tbounce</span><span class="p">;</span>
<span class="c1">#lxout (&quot;Bounce at = $tb s Top: $ttop s ($ytop m) &quot;);</span>

<span class="nv">$t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">for</span><span class="p">(</span><span class="k">my</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$nf</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$t</span> <span class="o">+=</span> <span class="nv">$dt</span><span class="p">;</span>

    <span class="c1"># initial position</span>
    <span class="nv">$val</span> <span class="o">=</span> <span class="nv">$y0</span><span class="p">;</span>

    <span class="c1"># plus initial constant velocity contribution</span>
    <span class="nv">$val</span> <span class="o">+=</span> <span class="nv">$v0</span> <span class="o">*</span> <span class="nv">$t</span><span class="p">;</span>

    <span class="c1"># plus acceleration contribution $val+=0.5*$a*$t*$t;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$t</span><span class="o">&gt;</span><span class="nv">$tb</span><span class="p">)</span> <span class="p">{</span>
         <span class="c1"># add key directly at bounce point!</span>
         <span class="nv">$tt</span> <span class="o">=</span> <span class="nv">$tscene</span> <span class="o">+</span> <span class="nv">$tb</span><span class="p">;</span>
         <span class="n">lx</span> <span class="p">(</span><span class="s">&quot;select.time $tt&quot;</span><span class="p">);</span>
         <span class="n">lx</span> <span class="p">(</span><span class="s">&quot;channel.key mode:add&quot;</span><span class="p">);</span>
         <span class="n">lx</span> <span class="p">(</span><span class="s">&quot;channel.value mode:set value:{$ymin}&quot;</span><span class="p">);</span>
         <span class="c1">#lx (&quot;key.break slope&quot;);</span>
         <span class="c1">#lx (&quot;key.slopeType linearIn in&quot;);</span>
         <span class="c1">#lx (&quot;key.slopeType linearOut out&quot;);</span>
         <span class="c1"># reset motion params</span>
         <span class="nv">$y0</span> <span class="o">=</span> <span class="nv">$ymin</span><span class="p">;</span>         <span class="c1"># start at bounce point</span>
         <span class="nv">$v0</span> <span class="o">=</span> <span class="nv">$vbounce</span><span class="p">;</span>      <span class="c1"># new initial velocity</span>
         <span class="nv">$tscene</span> <span class="o">+=</span> <span class="nv">$tb</span><span class="p">;</span>      <span class="c1"># reset time so t=0 at bounce</span>
         <span class="nv">$t</span><span class="o">=</span><span class="nv">$t</span><span class="o">-</span><span class="nv">$tb</span><span class="p">;</span>           <span class="c1"># next key &#39;t&#39; a bit after bounce</span>

         <span class="c1"># attenuate t,v</span>
         <span class="nv">$tbounce</span> <span class="o">=</span> <span class="nb">sqrt</span> <span class="p">(</span><span class="nv">$elastic</span><span class="p">)</span> <span class="o">*</span> <span class="nv">$tbounce</span><span class="p">;</span>
         <span class="nv">$vbounce</span> <span class="o">=</span> <span class="nb">sqrt</span> <span class="p">(</span><span class="nv">$elastic</span><span class="p">)</span> <span class="o">*</span> <span class="nv">$vbounce</span><span class="p">;</span>

         <span class="c1"># time up and time down</span>
         <span class="nv">$tb</span> <span class="o">=</span>  <span class="mi">2</span> <span class="o">*</span> <span class="nv">$tbounce</span><span class="p">;</span>

         <span class="c1"># recompute key after bounce</span>
         <span class="nv">$val</span> <span class="o">=</span> <span class="nv">$y0</span><span class="p">;</span>

         <span class="c1"># plus initial constant velocity contribution</span>
         <span class="nv">$val</span> <span class="o">+=</span> <span class="nv">$v0</span> <span class="o">*</span> <span class="nv">$t</span><span class="p">;</span>

         <span class="c1"># plus acceleration contribution</span>
         <span class="nv">$val</span><span class="o">+=</span><span class="mf">0.5</span><span class="o">*</span><span class="nv">$a</span><span class="o">*</span><span class="nv">$t</span><span class="o">*</span><span class="nv">$t</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="c1"># use absolute time, not per-bounce time</span>
   <span class="nv">$tt</span> <span class="o">=</span> <span class="nv">$tscene</span> <span class="o">+</span> <span class="nv">$t</span><span class="p">;</span>

   <span class="c1"># convert relative y back to absolute</span>
   <span class="nv">$y</span> <span class="o">=</span> <span class="nv">$val</span> <span class="o">+</span> <span class="nv">$ymin</span><span class="p">;</span>

   <span class="c1"># set time, add and set key</span>
   <span class="n">lx</span> <span class="p">(</span><span class="s">&quot;select.time $tt&quot;</span><span class="p">);</span>
   <span class="n">lx</span> <span class="p">(</span><span class="s">&quot;channel.key mode:add&quot;</span><span class="p">);</span>
   <span class="n">lx</span> <span class="p">(</span><span class="s">&quot;channel.value mode:set value:{$val}&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="tab-content docutils container" id="tab-lua">
<p class="tab-title">Lua</p>
<div class="highlight-lua notranslate"><div class="highlight"><pre><span></span><span class="c1">-- lua -- Bouncer.lua</span>
<span class="c1">-- Arnie Cachelin, Luxology LLC, Copyright 2007-2008</span>
<span class="c1">-- A Simple Dynamics Script -- Physics 101 equations of</span>
<span class="c1">-- motion in one dimension</span>

<span class="c1">-- This version specializes in the trajectory of a dropped or</span>
<span class="c1">-- launched object which bounces.</span>
<span class="c1">-- To use this, select the object which is already at the time</span>
<span class="c1">-- and place at its motion should start.</span>


<span class="c1">-- User Input animation parameters</span>
<span class="n">v0</span><span class="o">=</span><span class="mi">0</span>           <span class="c1">-- initial speed (m/s)</span>
<span class="n">time</span> <span class="o">=</span> <span class="mf">11.0</span>    <span class="c1">-- length of simulation (in seconds)</span>
<span class="n">ymin</span> <span class="o">=</span> <span class="mf">0.0</span>     <span class="c1">-- ground/wall position, where bounces would occur (m)</span>
<span class="n">elastic</span> <span class="o">=</span> <span class="mf">0.8</span>  <span class="c1">-- elasticity: percent energy kept per bounce</span>
<span class="n">fstep</span> <span class="o">=</span> <span class="mf">0.2</span>    <span class="c1">-- number of frames between keys</span>

<span class="c1">-- physical constants</span>
<span class="n">g</span><span class="o">=</span><span class="mf">9.8</span>          <span class="c1">-- gravity on earth = 9.8 m/s^2 DOWN</span>
<span class="n">a</span><span class="o">=-</span><span class="n">g</span>           <span class="c1">-- accleration (m/s^2) negative, since UP is positive</span>

<span class="c1">--lxtrace(1)   -- Use this for debugging</span>

<span class="c1">-- get selected locator-type item</span>
<span class="n">item</span> <span class="o">=</span> <span class="n">lxq</span><span class="p">(</span> <span class="s2">&quot;query sceneservice selection ? locator&quot;</span> <span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1">-- get its position transform item</span>
<span class="n">xfrm</span> <span class="o">=</span> <span class="n">lxq</span> <span class="p">(</span><span class="s2">&quot;query sceneservice item.xfrmPos ? &quot;</span><span class="o">..</span><span class="n">item</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

<span class="kr">if</span> <span class="n">xfrm</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="p">:</span>
    <span class="c1">-- Position transform item does not exist; create it</span>
    <span class="n">lx</span> <span class="p">(</span><span class="s2">&quot;transform.add type:pos&quot;</span><span class="p">)</span>
    <span class="n">xfrm</span> <span class="o">=</span> <span class="n">lxq</span> <span class="p">(</span><span class="s2">&quot;query sceneservice item.xfrmPiv ? &quot;</span> <span class="o">..</span><span class="n">item</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="kr">end</span>

<span class="c1">-- select the item in sceneservice for subsequent channel queries</span>
<span class="n">xnm</span> <span class="o">=</span> <span class="n">lxq</span> <span class="p">(</span><span class="s2">&quot;query sceneservice item.name ? &quot;</span><span class="o">..</span><span class="n">xfrm</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">chan</span> <span class="o">=</span> <span class="n">lxq</span><span class="p">(</span><span class="s2">&quot;query sceneservice channel.index ?  pos.Y&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">tf</span> <span class="o">=</span> <span class="n">lxq</span> <span class="p">(</span><span class="s2">&quot;time.range scene out:?&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">ti</span> <span class="o">=</span> <span class="n">lxq</span> <span class="p">(</span><span class="s2">&quot;select.time ?&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1">-- starting time: Now!</span>
<span class="n">time</span> <span class="o">=</span> <span class="n">tf</span> <span class="o">-</span> <span class="n">ti</span>                 <span class="c1">-- final time</span>
<span class="n">val</span> <span class="o">=</span> <span class="n">lxq</span> <span class="p">(</span><span class="s2">&quot;query sceneservice channel.value ? &quot;</span><span class="o">..</span><span class="n">chan</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">fps</span> <span class="o">=</span> <span class="n">lxq</span> <span class="p">(</span><span class="s2">&quot;time.fpsCustom ?&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">fstep</span> <span class="o">/</span> <span class="n">fps</span>               <span class="c1">-- add keys every other frame</span>
<span class="n">nf</span> <span class="o">=</span> <span class="n">time</span> <span class="o">*</span> <span class="n">fps</span> <span class="o">/</span> <span class="n">fstep</span>        <span class="c1">-- number of frames</span>

<span class="n">y0</span> <span class="o">=</span> <span class="n">val</span> <span class="o">-</span> <span class="n">ymin</span>                <span class="c1">-- initial position</span>

<span class="c1">--lxout (&quot;Time = &quot;..time..&quot; ( &quot;..nf..&quot; frames at &quot;..fps..&quot; fps ) from &quot;..ti..&quot; s to &quot;..tf..&quot; s by &quot;..dt..&quot; s&quot;)    -- Use this for debugging</span>


<span class="c1">-- calculation section, where plenty of other important things are derived from the inputs</span>

<span class="c1">-- maximum height reached, (where vtop==0)</span>
<span class="n">ytop</span> <span class="o">=</span> <span class="p">((</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">v0</span> <span class="o">*</span> <span class="n">v0</span><span class="p">)</span><span class="o">/</span><span class="n">g</span><span class="p">)</span> <span class="o">+</span> <span class="n">y0</span>

<span class="c1">-- time to reach ytop from y0</span>
<span class="n">ttop</span> <span class="o">=</span> <span class="p">(</span><span class="n">v0</span><span class="p">)</span><span class="o">/</span><span class="n">g</span>

<span class="c1">-- time to hit ground from ytop</span>
<span class="n">tbounce</span> <span class="o">=</span> <span class="n">sqrt</span> <span class="p">((</span><span class="n">ttop</span> <span class="o">*</span> <span class="n">ttop</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">y0</span> <span class="o">/</span> <span class="n">g</span><span class="p">)</span>

<span class="c1">-- speed at bounce, deduced from energy conservation</span>
<span class="n">vbounce</span> <span class="o">=</span> <span class="n">sqrt</span> <span class="p">((</span><span class="n">v0</span><span class="o">*</span><span class="n">v0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="n">y0</span><span class="p">)</span>

<span class="c1">--lxout (&quot;Top at: &quot;..ttop..&quot; s (&quot;..ytop..&quot; m) Bounces &quot;..tbounce..&quot; s later&quot;)</span>


<span class="c1">-- add initial key at current time</span>
<span class="n">lx</span> <span class="p">(</span><span class="s2">&quot;channel.key mode:add channel:{&quot;</span><span class="o">..</span><span class="n">xfrm</span><span class="o">..</span><span class="s2">&quot;:&quot;</span><span class="o">..</span><span class="n">chan</span><span class="o">..</span><span class="s2">&quot;}&quot;</span><span class="p">)</span>
<span class="n">lx</span> <span class="p">(</span><span class="s2">&quot;select.channel mode:set channel:{&quot;</span><span class="o">..</span><span class="n">xfrm</span><span class="o">..</span><span class="s2">&quot;:&quot;</span><span class="o">..</span><span class="n">chan</span><span class="o">..</span><span class="s2">&quot;}&quot;</span><span class="p">)</span>
<span class="n">lx</span> <span class="p">(</span><span class="s2">&quot;channel.interpolation linear&quot;</span><span class="p">)</span>
<span class="n">lx</span> <span class="p">(</span><span class="s2">&quot;channel.value mode:set value:{&quot;</span><span class="o">..</span><span class="n">val</span><span class="o">..</span><span class="s2">&quot;}&quot;</span><span class="p">)</span>

<span class="n">tscene</span> <span class="o">=</span> <span class="n">ti</span>
<span class="n">tt</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1">-- time of next bounce relative to t0</span>
<span class="n">tb</span> <span class="o">=</span> <span class="n">ttop</span> <span class="o">+</span> <span class="n">tbounce</span>
<span class="c1">--lxout (&quot;Bounce at = &quot;..tb..&quot; s Top: &quot;..ttop..&quot; s (&quot;..ytop..&quot; m) &quot;)</span>

<span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
<span class="kr">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">nf</span> <span class="kr">do</span>
    <span class="n">t</span> <span class="o">+=</span> <span class="n">dt</span>

    <span class="c1">-- initial position</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">y0</span>

    <span class="c1">-- plus initial constant velocity contribution</span>
    <span class="n">val</span> <span class="o">+=</span> <span class="n">v0</span> <span class="o">*</span> <span class="n">t</span>

    <span class="c1">-- plus acceleration contribution val+=0.5*a*t*t</span>
    <span class="kr">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">tb</span>  <span class="kr">then</span>
         <span class="c1">-- add key directly at bounce point!</span>
         <span class="n">tt</span> <span class="o">=</span> <span class="n">tscene</span> <span class="o">+</span> <span class="n">tb</span>
         <span class="n">lx</span> <span class="p">(</span><span class="s2">&quot;select.time &quot;</span> <span class="o">..</span><span class="n">tt</span><span class="p">)</span>
         <span class="n">lx</span> <span class="p">(</span><span class="s2">&quot;channel.key mode:add&quot;</span><span class="p">)</span>
         <span class="n">lx</span> <span class="p">(</span><span class="s2">&quot;channel.value mode:set value:{&quot;</span><span class="o">..</span><span class="n">ymin</span><span class="o">..</span><span class="s2">&quot;}&quot;</span><span class="p">)</span>
         <span class="c1">--lx (&quot;key.break slope&quot;)</span>
         <span class="c1">--lx (&quot;key.slopeType linearIn in&quot;)</span>
         <span class="c1">--lx (&quot;key.slopeType linearOut out&quot;)</span>
         <span class="c1">-- reset motion params</span>
         <span class="n">y0</span> <span class="o">=</span> <span class="n">ymin</span>       <span class="c1">-- start at bounce point</span>
         <span class="n">v0</span> <span class="o">=</span> <span class="n">vbounce</span>    <span class="c1">-- new initial velocity</span>
         <span class="n">tscene</span> <span class="o">+=</span> <span class="n">tb</span>    <span class="c1">-- reset time so t=0 at bounce</span>
         <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="o">-</span><span class="n">tb</span>          <span class="c1">-- next key &#39;t&#39; a bit after bounce</span>

         <span class="c1">-- attenuate t,v</span>
         <span class="n">tbounce</span> <span class="o">=</span> <span class="n">sqrt</span> <span class="p">(</span><span class="n">elastic</span><span class="p">)</span> <span class="o">*</span> <span class="n">tbounce</span>
         <span class="n">vbounce</span> <span class="o">=</span> <span class="n">sqrt</span> <span class="p">(</span><span class="n">elastic</span><span class="p">)</span> <span class="o">*</span> <span class="n">vbounce</span>

         <span class="c1">-- time up and time down</span>
         <span class="n">tb</span> <span class="o">=</span>  <span class="mi">2</span> <span class="o">*</span> <span class="n">tbounce</span>

         <span class="c1">-- recompute key after bounce</span>
         <span class="n">val</span> <span class="o">=</span> <span class="n">y0</span>

         <span class="c1">-- plus initial constant velocity contribution</span>
         <span class="n">val</span> <span class="o">+=</span> <span class="n">v0</span> <span class="o">*</span> <span class="n">t</span>

         <span class="c1">-- plus acceleration contribution</span>
         <span class="n">val</span><span class="o">+=</span><span class="mf">0.5</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="o">*</span><span class="n">t</span>
   <span class="kr">end</span>

   <span class="c1">-- use absolute time, not per-bounce time</span>
   <span class="n">tt</span> <span class="o">=</span> <span class="n">tscene</span> <span class="o">+</span> <span class="n">t</span>

   <span class="c1">-- convert relative y back to absolute</span>
   <span class="n">y</span> <span class="o">=</span> <span class="n">val</span> <span class="o">+</span> <span class="n">ymin</span>

   <span class="c1">-- set time, add and set key</span>
   <span class="n">lx</span> <span class="p">(</span><span class="s2">&quot;select.time &quot;</span><span class="o">..</span><span class="n">tt</span><span class="p">)</span>
   <span class="n">lx</span> <span class="p">(</span><span class="s2">&quot;channel.key mode:add&quot;</span><span class="p">)</span>
   <span class="n">lx</span> <span class="p">(</span><span class="s2">&quot;channel.value mode:set value:{&quot;</span><span class="o">..</span><span class="n">val</span><span class="o">..</span><span class="s2">&quot;}&quot;</span><span class="p">)</span>
<span class="kr">end</span>
</pre></div>
</div>
</div>
<div class="tab-content docutils container" id="tab-python">
<p class="tab-title">Python</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># python -- Bouncer.py</span>
<span class="c1"># Arnie Cachelin, Luxology LLC, Copyright 2007-2008</span>
<span class="c1"># A Simple Dynamics Script -- Physics 101 equations of</span>
<span class="c1"># motion in one dimension</span>

<span class="c1"># This version specializes in the trajectory of a dropped or</span>
<span class="c1"># launched object which bounces.</span>
<span class="c1"># To use this, select the object which is already at the time</span>
<span class="c1"># and place at its motion should start.</span>

<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>

<span class="c1"># User Input animation parameters</span>
<span class="n">v0</span> <span class="o">=</span> <span class="mi">0</span>            <span class="c1"># initial speed (m/s)</span>
<span class="n">ymin</span> <span class="o">=</span> <span class="mf">0.0</span>     <span class="c1"># ground/wall position, where bounces would occur (m)</span>
<span class="n">elastic</span> <span class="o">=</span> <span class="mf">0.8</span>   <span class="c1"># elasticity: percent energy kept per bounce</span>
<span class="n">fstep</span> <span class="o">=</span> <span class="mf">2.0</span>    <span class="c1"># number of frames between keys</span>

<span class="c1"># physical constants</span>
<span class="n">g</span> <span class="o">=</span> <span class="mf">9.8</span>          <span class="c1"># gravity on earth = 9.8 m/s^2 DOWN</span>
<span class="n">a</span> <span class="o">=</span> <span class="o">-</span><span class="n">g</span>           <span class="c1"># accleration (m/s^2) negative, since UP is positive</span>

<span class="c1">#lx.trace(1)   # Use this for debugging</span>

<span class="c1"># get selected locator-type item</span>
<span class="n">item</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">eval1</span><span class="p">(</span> <span class="s2">&quot;query sceneservice selection ? locator&quot;</span> <span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;LXe_FAILED: Need to select an item&quot;</span><span class="p">)</span>

<span class="c1"># get its position transform item</span>
<span class="n">xfrm</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">eval1</span><span class="p">(</span> <span class="s2">&quot;query sceneservice item.xfrmPos ? &quot;</span> <span class="o">+</span> <span class="n">item</span> <span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">xfrm</span><span class="p">:</span>
    <span class="c1"># Position transform item does not exist; create it</span>
     <span class="n">lx</span><span class="o">.</span><span class="n">command</span> <span class="p">(</span><span class="s2">&quot;transform.add&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;pos&quot;</span><span class="p">)</span>
     <span class="n">xfrm</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">eval1</span> <span class="p">(</span><span class="s2">&quot;query sceneservice item.xfrmPos ? &quot;</span> <span class="o">+</span> <span class="n">item</span><span class="p">)</span>

<span class="c1"># select the item in sceneservice for subsequent channel queries</span>
<span class="n">xnm</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">eval1</span> <span class="p">(</span><span class="s2">&quot;query sceneservice item.name ? &quot;</span> <span class="o">+</span> <span class="n">xfrm</span><span class="p">)</span>

<span class="n">chan</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">eval1</span> <span class="p">(</span><span class="s2">&quot;query sceneservice channel.index ?  pos.Y&quot;</span><span class="p">)</span>
<span class="n">tf</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">eval1</span> <span class="p">(</span><span class="s2">&quot;time.range scene out:?&quot;</span><span class="p">)</span>
<span class="n">ti</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">eval1</span> <span class="p">(</span><span class="s2">&quot;select.time ?&quot;</span><span class="p">)</span>     <span class="c1"># starting time: Now!</span>
<span class="n">time</span> <span class="o">=</span> <span class="n">tf</span> <span class="o">-</span> <span class="n">ti</span>              <span class="c1"># final time</span>

<span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">lx</span><span class="o">.</span><span class="n">eval1</span> <span class="p">(</span><span class="s2">&quot;query sceneservice channel.value ? &quot;</span> <span class="o">+</span> <span class="n">chan</span><span class="p">))</span> <span class="c1">#bug: returns string value</span>
<span class="n">fps</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">eval1</span> <span class="p">(</span><span class="s2">&quot;time.fpsCustom ?&quot;</span><span class="p">)</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">fstep</span> <span class="o">/</span> <span class="n">fps</span>            <span class="c1"># add keys every other frame</span>
<span class="n">nf</span> <span class="o">=</span> <span class="n">time</span> <span class="o">*</span> <span class="n">fps</span> <span class="o">/</span> <span class="n">fstep</span>     <span class="c1"># number of frames</span>

<span class="n">y0</span> <span class="o">=</span> <span class="n">val</span> <span class="o">-</span> <span class="n">ymin</span>              <span class="c1"># initial position</span>

<span class="c1">#lx.out (&quot;Time = &quot;, time, &quot; ( &quot;, nf, &quot; frames at &quot;, fps, &quot; fps ) from &quot;, ti, &quot; s to &quot;, tf, &quot; s by &quot;, dt, &quot; s&quot;,    # Use this for debugging</span>


<span class="c1"># calculation section, where plenty of other important things are derived from the inputs</span>

<span class="c1"># maximum height reached, (where vtop==0)</span>
<span class="n">ytop</span> <span class="o">=</span> <span class="p">((</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">v0</span> <span class="o">*</span> <span class="n">v0</span><span class="p">)</span> <span class="o">/</span> <span class="n">g</span><span class="p">)</span> <span class="o">+</span> <span class="n">y0</span>

<span class="c1"># time to reach ytop from y0</span>
<span class="n">ttop</span> <span class="o">=</span> <span class="n">v0</span> <span class="o">/</span> <span class="n">g</span>

<span class="c1"># time to hit ground from ytop</span>
<span class="n">tbounce</span> <span class="o">=</span> <span class="n">sqrt</span> <span class="p">((</span><span class="n">ttop</span> <span class="o">*</span> <span class="n">ttop</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">y0</span> <span class="o">/</span> <span class="n">g</span><span class="p">)</span>

<span class="c1"># speed at bounce, deduced from energy conservation</span>
<span class="n">vbounce</span> <span class="o">=</span> <span class="n">sqrt</span> <span class="p">((</span><span class="n">v0</span> <span class="o">*</span> <span class="n">v0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">g</span> <span class="o">*</span> <span class="n">y0</span><span class="p">)</span>

<span class="c1">#lx.out (&quot;Top at: &quot;, ttop, &quot; s (&quot;, ytop, &quot; m) Bounces &quot;, tbounce, &quot; s later&quot;)</span>


<span class="c1"># add initial key at current time</span>
<span class="n">lx</span><span class="o">.</span><span class="n">command</span> <span class="p">(</span><span class="s2">&quot;select.channel&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;set&quot;</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="n">xfrm</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="n">chan</span><span class="p">)</span>
<span class="n">lx</span><span class="o">.</span><span class="n">command</span> <span class="p">(</span><span class="s2">&quot;channel.interpolation&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
<span class="n">lx</span><span class="o">.</span><span class="n">command</span> <span class="p">(</span><span class="s2">&quot;channel.key&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">val</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;add&quot;</span><span class="p">)</span>

<span class="n">tscene</span> <span class="o">=</span> <span class="n">ti</span>
<span class="n">tt</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># time of next bounce relative to t0</span>
<span class="n">tb</span> <span class="o">=</span> <span class="n">ttop</span> <span class="o">+</span> <span class="n">tbounce</span>

<span class="c1">#lx.out (&quot;Bounce at = &quot;, tb, &quot; s Top: &quot;, ttop, &quot; s (&quot;, ytop, &quot; m) &quot;)</span>

<span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nf</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">+=</span> <span class="n">dt</span>

    <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">tb</span><span class="p">:</span>
        <span class="c1"># add key directly at bounce point!</span>
        <span class="n">tt</span> <span class="o">=</span> <span class="n">tscene</span> <span class="o">+</span> <span class="n">tb</span>
        <span class="n">lx</span><span class="o">.</span><span class="n">command</span> <span class="p">(</span><span class="s2">&quot;channel.key&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">tt</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;add&quot;</span><span class="p">)</span>

        <span class="c1"># attenuate t,v</span>
        <span class="n">tbounce</span> <span class="o">=</span> <span class="n">sqrt</span> <span class="p">(</span><span class="n">elastic</span><span class="p">)</span> <span class="o">*</span> <span class="n">tbounce</span>
        <span class="n">vbounce</span> <span class="o">=</span> <span class="n">sqrt</span> <span class="p">(</span><span class="n">elastic</span><span class="p">)</span> <span class="o">*</span> <span class="n">vbounce</span>

        <span class="c1"># reset motion params</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="n">ymin</span>         <span class="c1"># start at bounce point</span>
        <span class="n">v0</span> <span class="o">=</span> <span class="n">vbounce</span>      <span class="c1"># new initial velocity</span>
        <span class="n">tscene</span> <span class="o">+=</span> <span class="n">tb</span>      <span class="c1"># reset time so t=0 at bounce</span>
        <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="o">-</span><span class="n">tb</span>          <span class="c1"># next key &#39;t&#39; a bit after bounce</span>

        <span class="c1"># time up and time down</span>
        <span class="n">tb</span> <span class="o">=</span>  <span class="mf">2.0</span> <span class="o">*</span> <span class="n">tbounce</span>

    <span class="c1"># recompute key after bounce</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">y0</span>

    <span class="c1"># plus initial constant velocity contribution</span>
    <span class="n">val</span> <span class="o">+=</span> <span class="n">v0</span> <span class="o">*</span> <span class="n">t</span>

    <span class="c1"># plus acceleration contribution</span>
    <span class="n">val</span> <span class="o">+=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span>

    <span class="c1"># use absolute time, not per-bounce time</span>
    <span class="n">tt</span> <span class="o">=</span> <span class="n">tscene</span> <span class="o">+</span> <span class="n">t</span>

    <span class="c1"># convert relative y back to absolute</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">val</span> <span class="o">+</span> <span class="n">ymin</span>

    <span class="c1"># set time, add and set key</span>
    <span class="n">lx</span><span class="o">.</span><span class="n">command</span> <span class="p">(</span><span class="s2">&quot;channel.key&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">tt</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;add&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="more-information">
<h2><a class="toc-backref" href="#id5">More Information</a><a class="headerlink" href="#more-information" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="Perl.html"><span class="doc">Perl</span></a></p></li>
<li><p><a class="reference internal" href="Scripting.html"><span class="doc">Scripting</span></a></p></li>
<li><p><a class="reference internal" href="../general/systems/Command%20System.html"><span class="doc">Command System</span></a></p></li>
<li><p><a class="reference internal" href="../ui/User%20Values.html"><span class="doc">User Values</span></a></p></li>
<li><p><a class="reference internal" href="ScriptQuery%20Overview.html"><span class="doc">ScriptQuery Overview</span></a></p></li>
<li><p><a class="reference internal" href="../ui/Form%20System.html"><span class="doc">Form System</span></a></p></li>
<li><p>Script Examples</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ChangeRenderFrameRange%20Script.html" class="btn btn-neutral float-right" title="ChangeRenderFrameRange Script" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="AppleScript.html" class="btn btn-neutral float-left" title="AppleScript" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Foundry

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org/">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>

<!-- Mirrored from learn.foundry.com/modo/developers/latest/sdk/pages/scripting/Bouncing Ball Script (Transform Channels).html by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 30 Nov 2024 03:16:00 GMT -->
</html>