

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->

<!-- Mirrored from learn.foundry.com/modo/developers/latest/sdk/pages/general/serverinfo/Visitors in Action.html by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 30 Nov 2024 03:15:53 GMT -->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Visitors in Action &mdash; Modo SDK 14.2v0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
        <script src="../../../_static/js/contentui.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="About Metaclasses" href="../metaclasses/About%20Metaclasses.html" />
    <link rel="prev" title="Using a Spawner" href="Using%20a%20Spawner.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Modo SDK
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="https://learn.foundry.com/modo/developers/latest/sdk/search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Articles</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../starting/_starting.html">First Steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../server_basics/_server_basics.html">Server Basics</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../_general.html">Editorial Info</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../_general.html#general-info">General Info</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_general.html#underlying-systems">Underlying Systems</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../_general.html#interface-details">Interface Details</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="CLxImpl%20Tool.html">CLxImpl Tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="Channel%20Modifier.html">Channel Modifier</a></li>
<li class="toctree-l3"><a class="reference internal" href="Global%20Listener%20Object.html">Global Listener Object</a></li>
<li class="toctree-l3"><a class="reference internal" href="Mesh%20Operation%20-%20Overview.html">Mesh Operation - Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="Selection%20Operation%20-%20Overview.html">Selection Operation - Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="Tool%20Operation%20-%20Overview.html">Tool Operation - Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="Treeview.html">Treeview</a></li>
<li class="toctree-l3"><a class="reference internal" href="Using%20a%20Spawner.html">Using a Spawner</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Visitors in Action</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#enumeration-methods">Enumeration Methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="#visitor-evaluation">Visitor Evaluation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#abstract-visitor">Abstract Visitor</a></li>
<li class="toctree-l4"><a class="reference internal" href="#one-visitor">One Visitor</a></li>
<li class="toctree-l4"><a class="reference internal" href="#spawned-visitor">Spawned Visitor</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../_general.html#metaclasses">MetaClasses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_general.html#additional-resources">Additional Resources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../ui/_ui.html">User Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scripting/_scripting.html">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faqs/_faqs.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption"><span class="caption-text">Code Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/_tutorials.html">SDK Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/_examples.html">Code Examples and Snippets</a></li>
</ul>
<p class="caption"><span class="caption-text">Technical Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../python/python.html">Python Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cpp/cpp.html">C++ Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Modo SDK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../_general.html">Editorial Info</a> &raquo;</li>
        
      <li>Visitors in Action</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="visitors-in-action">
<h1>Visitors in Action<a class="headerlink" href="#visitors-in-action" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#enumeration-methods" id="id1">Enumeration Methods</a></p></li>
<li><p><a class="reference internal" href="#visitor-evaluation" id="id2">Visitor Evaluation</a></p></li>
<li><p><a class="reference internal" href="#abstract-visitor" id="id3">Abstract Visitor</a></p></li>
<li><p><a class="reference internal" href="#one-visitor" id="id4">One Visitor</a></p></li>
<li><p><a class="reference internal" href="#spawned-visitor" id="id5">Spawned Visitor</a></p></li>
</ul>
</div>
<p>Visitors are a general mechanism allowing clients (plug-ins) to traverse the system’s (modo’s) internal state. The client essentially defines a single action function to be performed over and over as the system walks some internal database. At each step the client can query the system about the current state of the enumeration, and abort the enumeration if it wants to. Visitors can also be used to cause a client action to happen in a specific state.</p>
<p>Although this is related to the [<a class="reference external" href="http://en.wikipedia.org/wiki/Visitor_pattern">http://en.wikipedia.org/wiki/Visitor_pattern</a> Visitor pattern], it’s a very minimal implementation. Although the simplicity makes it easy to reuse for multiple purposes, it does take a little practice to understand how to use it.</p>
<div class="section" id="enumeration-methods">
<h2><a class="toc-backref" href="#id1">Enumeration Methods</a><a class="headerlink" href="#enumeration-methods" title="Permalink to this headline">¶</a></h2>
<p>Interfaces provide enumeration methods to allow a client to traverse the contents of some container or database, especially when access by count and index are inefficient or otherwise undesirable. A typical example are the mesh accessors. These objects are allocated specifically for investigating the features of mesh elements: points, polygons, edges and maps. Methods on the object allow the client to select elements by index or ID and then to query the object for the element’s properties.</p>
<p>In addition there are also enumeration methods. These take a mark mode, a visitor, and a monitor.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>         <span class="p">[[</span><span class="n">LXxMETHOD</span> <span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="o">|</span><span class="n">LXxMETHOD</span><span class="p">]](</span>  <span class="p">[[</span><span class="n">LxResult</span> <span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="o">|</span><span class="n">LxResult</span><span class="p">]],</span>
 <span class="n">Enumerate</span><span class="p">)</span> <span class="p">(</span>
         <span class="p">[[</span><span class="n">LXtObjectID</span> <span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="o">|</span><span class="n">LXtObjectID</span><span class="p">]]</span>              <span class="bp">self</span><span class="p">,</span>
         <span class="n">LXtMarkMode</span>              <span class="n">mode</span><span class="p">,</span>
         <span class="p">[[</span><span class="n">LXtObjectID</span> <span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="o">|</span><span class="n">LXtObjectID</span><span class="p">]]</span>              <span class="n">visitor</span><span class="p">,</span>
         <span class="p">[[</span><span class="n">LXtObjectID</span> <span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="o">|</span><span class="n">LXtObjectID</span><span class="p">]]</span>              <span class="n">monitor</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<p>The mark mode identifies a subset of elements to traverse, and the Monitor Interface gives feedback about the overall progress. The visitor object is used to allow the client to act on each element during the traversal. Even when Count/ByIndex methods are available, an enumeration call will generally be more efficient and should be preferred, all things being equal.</p>
</div>
<div class="section" id="visitor-evaluation">
<h2><a class="toc-backref" href="#id2">Visitor Evaluation</a><a class="headerlink" href="#visitor-evaluation" title="Permalink to this headline">¶</a></h2>
<p>The <strong>Visitor::Evaluate()</strong> method is called for each element, and the visitor is expected to request attributes of the current element that it wants to query. Let’s say we want to make a list of point positions in a mesh. The general outline of this process would be to:</p>
<ul class="simple">
<li><p>allocate a point accessor</p></li>
<li><p>create a visitor</p></li>
<li><dl class="simple">
<dt>enumerate the points:</dt><dd><ul>
<li><dl class="simple">
<dt>for each point:</dt><dd><ul>
<li><p>query point position</p></li>
<li><p>add to list</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="abstract-visitor">
<h2><a class="toc-backref" href="#id3">Abstract Visitor</a><a class="headerlink" href="#abstract-visitor" title="Permalink to this headline">¶</a></h2>
<p>Fortunately there are some wrappers that make this process relatively easy. Many of the user classes define alternate methods that take ‘’abstract visitors’’. For example all the mesh accessors have alternate methods defined like this:</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span>         <span class="p">[[</span><span class="n">LxResult</span> <span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="o">|</span><span class="n">LxResult</span><span class="p">]]</span>
 <span class="n">Enum</span> <span class="p">(</span>
         <span class="n">CLxImpl_AbstractVisitor</span> <span class="o">*</span><span class="n">visitor</span><span class="p">,</span>
         <span class="n">LXtMarkMode</span>              <span class="n">mode</span> <span class="o">=</span> <span class="p">[[</span><span class="n">LXiMARK_ANY</span> <span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="o">|</span><span class="n">LXiMARK_ANY</span><span class="p">]],</span>
         <span class="p">[[</span><span class="n">ILxUnknownID</span> <span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="o">|</span><span class="n">ILxUnknownID</span><span class="p">]]</span>             <span class="n">mon</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>These C++ methods take <strong>CLxImpl_AbstractVisitor</strong> instead of generic objects along with other conveniences like optional arguments. The ‘’abstract visitor’’ class requires a simple C++ method without any COM-related rigamarole. Here’s all the code required to build a point position list using the user method.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="k">class</span> <span class="nc">CPointList</span> <span class="p">:</span> <span class="n">public</span> <span class="n">CLxImpl_AbstractVisitor</span>
 <span class="p">{</span>
     <span class="n">public</span><span class="p">:</span>
        <span class="n">CLxUser_Point</span>            <span class="n">point</span><span class="p">;</span>
        <span class="n">std</span><span class="p">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">LXtFVector</span><span class="o">&gt;</span>  <span class="nb">list</span><span class="p">;</span>

                <span class="n">LxResult</span>
        <span class="n">Evaluate</span> <span class="p">()</span>
        <span class="p">{</span>
                <span class="n">LXtFVector</span>       <span class="n">pos</span><span class="p">;</span>

                <span class="n">point</span><span class="o">.</span><span class="n">Pos</span> <span class="p">(</span><span class="n">pos</span><span class="p">);</span>
                <span class="nb">list</span><span class="o">.</span><span class="n">push_back</span> <span class="p">(</span><span class="n">pos</span><span class="p">);</span>
                <span class="k">return</span> <span class="n">LXe_OK</span><span class="p">;</span>
        <span class="p">}</span>
 <span class="p">};</span>

        <span class="n">static</span> <span class="n">void</span>
 <span class="n">GetPointList</span> <span class="p">(</span>
        <span class="n">CLxUser_Mesh</span>            <span class="o">&amp;</span><span class="n">mesh</span><span class="p">,</span>
        <span class="n">CPointList</span>              <span class="o">&amp;</span><span class="n">plist</span><span class="p">)</span>
 <span class="p">{</span>
        <span class="n">plist</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">fromMesh</span> <span class="p">(</span><span class="n">mesh</span><span class="p">);</span>
        <span class="n">plist</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">Enum</span> <span class="p">(</span><span class="n">plist</span><span class="p">);</span>
 <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>There are several important things to notice about this example. First the visitor is just a C++ class deriving from ‘’’CLxImpl_AbstractVisitor’’’. The <em>CLxImpl_</em> prefix normally means that the class requires a COM wrapper, but in this case that’s just an incorrect use of the naming conventions. In fact the <em>Evaluate()</em> method derived from the superclass is sufficient.</p>
<p>Second, the point accessor is part of the member data of the visitor. This allows the visitor to query the state of the accessor during evaluation, which is critical for reading out the state of the current element as the mesh is traversed.</p>
<p>Finally, <em>Evaluate()</em> returns ‘’LXe_OK’’. If it returned anything else the enumeration would have aborted and the Enum() method would have returned that result rather than OK.</p>
</div>
<div class="section" id="one-visitor">
<h2><a class="toc-backref" href="#id4">One Visitor</a><a class="headerlink" href="#one-visitor" title="Permalink to this headline">¶</a></h2>
<p>There may be interfaces that don’t have nice user methods. What if something really requires a real visitor object and has no C++ alternate? That’s also easy – we can use the <strong>CLxInst_OneVisitor</strong> class to create a singleton. For example the previous code can be rewritten to use the raw <em>Enumerate()</em> method rather than the <em>Enum()</em> user wrapper.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="k">class</span> <span class="nc">CPointList</span>
 <span class="p">{</span>
     <span class="n">public</span><span class="p">:</span>
        <span class="n">CLxUser_Point</span>            <span class="n">point</span><span class="p">;</span>
        <span class="n">std</span><span class="p">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">LXtFVector</span><span class="o">&gt;</span>  <span class="nb">list</span><span class="p">;</span>

                <span class="n">LxResult</span>
        <span class="n">Evaluate</span> <span class="p">()</span>
        <span class="p">{</span>
                <span class="n">LXtFVector</span>       <span class="n">pos</span><span class="p">;</span>

                <span class="n">point</span><span class="o">.</span><span class="n">Pos</span> <span class="p">(</span><span class="n">pos</span><span class="p">);</span>
                <span class="nb">list</span><span class="o">.</span><span class="n">push_back</span> <span class="p">(</span><span class="n">pos</span><span class="p">);</span>
                <span class="k">return</span> <span class="n">LXe_OK</span><span class="p">;</span>
        <span class="p">}</span>
 <span class="p">};</span>

        <span class="n">static</span> <span class="n">std</span><span class="p">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">LXtFVector</span><span class="o">&gt;</span>
 <span class="n">GetPointList</span> <span class="p">(</span>
        <span class="n">CLxUser_Mesh</span>            <span class="o">&amp;</span><span class="n">mesh</span><span class="p">)</span>
 <span class="p">{</span>
        <span class="n">CLxInst_OneVisitor</span><span class="o">&lt;</span><span class="n">CPointList</span><span class="o">&gt;</span> <span class="n">one</span><span class="p">;</span>

        <span class="n">one</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">fromMesh</span> <span class="p">(</span><span class="n">mesh</span><span class="p">);</span>
        <span class="n">one</span><span class="o">.</span><span class="n">point</span><span class="o">.</span><span class="n">Enumerate</span> <span class="p">(</span><span class="n">plist</span><span class="p">,</span> <span class="n">LXiMARK_ANY</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">one</span><span class="o">.</span><span class="n">loc</span><span class="o">.</span><span class="n">list</span><span class="p">;</span>
 <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>What’s basically happening here is that the ‘’One Visitor’’ template class is doing the hard work of creating a single, one-use COM object for the purpose of enumeration. Admittedly some of the other tradeoffs are different too; it’s a different way of doing effectively the same thing.</p>
</div>
<div class="section" id="spawned-visitor">
<h2><a class="toc-backref" href="#id5">Spawned Visitor</a><a class="headerlink" href="#spawned-visitor" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="o">...</span> <span class="n">TBD</span> <span class="o">...</span>
</pre></div>
</td></tr></table></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../metaclasses/About%20Metaclasses.html" class="btn btn-neutral float-right" title="About Metaclasses" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Using%20a%20Spawner.html" class="btn btn-neutral float-left" title="Using a Spawner" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Foundry

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org/">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>

<!-- Mirrored from learn.foundry.com/modo/developers/latest/sdk/pages/general/serverinfo/Visitors in Action.html by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 30 Nov 2024 03:15:53 GMT -->
</html>