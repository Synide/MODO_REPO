

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->

<!-- Mirrored from learn.foundry.com/modo/developers/latest/sdk/pages/general/systems/Interfacing with the Undo System.html by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 30 Nov 2024 03:15:52 GMT -->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Interfacing with the Undo System &mdash; Modo SDK 14.2v0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
        <script src="../../../_static/js/contentui.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Selection System Overview" href="Selection%20System%20Overview.html" />
    <link rel="prev" title="Headless" href="Headless.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Modo SDK
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="https://learn.foundry.com/modo/developers/latest/sdk/search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Articles</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../starting/_starting.html">First Steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../server_basics/_server_basics.html">Server Basics</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../_general.html">Editorial Info</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../_general.html#general-info">General Info</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../_general.html#underlying-systems">Underlying Systems</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="Bonjour.html">Bonjour</a></li>
<li class="toctree-l3"><a class="reference internal" href="Command%20System.html">Command System</a></li>
<li class="toctree-l3"><a class="reference internal" href="DDE.html">DDE</a></li>
<li class="toctree-l3"><a class="reference internal" href="Headless.html">Headless</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Interfacing with the Undo System</a></li>
<li class="toctree-l3"><a class="reference internal" href="Selection%20System%20Overview.html">Selection System Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="Telnet.html">Telnet</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../_general.html#interface-details">Interface Details</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_general.html#metaclasses">MetaClasses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_general.html#additional-resources">Additional Resources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../ui/_ui.html">User Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scripting/_scripting.html">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faqs/_faqs.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption"><span class="caption-text">Code Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/_tutorials.html">SDK Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/_examples.html">Code Examples and Snippets</a></li>
</ul>
<p class="caption"><span class="caption-text">Technical Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../python/python.html">Python Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cpp/cpp.html">C++ Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Modo SDK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../_general.html">Editorial Info</a> &raquo;</li>
        
      <li>Interfacing with the Undo System</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="interfacing-with-the-undo-system">
<h1>Interfacing with the Undo System<a class="headerlink" href="#interfacing-with-the-undo-system" title="Permalink to this headline">¶</a></h1>
<p>To handle your own undos you need to declare your undo object class.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="k">class</span> <span class="nc">CMyUndo</span> <span class="p">:</span> <span class="n">public</span> <span class="n">CLxImpl_</span><span class="p">[[</span><span class="n">Undo</span> <span class="n">Interface</span><span class="o">|</span><span class="n">Undo</span><span class="p">]]</span>
 <span class="p">{</span>
     <span class="n">public</span><span class="p">:</span>
         <span class="n">void</span>         <span class="n">undo_Forward</span> <span class="p">()</span>     <span class="n">LXx_OVERRIDE</span><span class="p">;</span>
         <span class="n">void</span>         <span class="n">undo_Reverse</span> <span class="p">()</span>     <span class="n">LXx_OVERRIDE</span><span class="p">;</span>
 <span class="p">};</span>
</pre></div>
</td></tr></table></div>
<p>This object represents your undo action and will be managed by the undo system. The <em>forward</em> method will be called when your action is applied (“done”) or redone, and <em>reverse</em> will be called when your action is undone.</p>
<p>Let’s say, for example, that your undo state is a global string value, like the name of something. When you change the name you want to register the undo action to change it back. If the action is undone the name will go back to the original name, and if the action is redone then the name will change to the new name again. Since this action effectively performs a swap, the forward and reverse actions are essentially the same. Here’s an example of such an undo object:</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="k">class</span> <span class="nc">CSwapName</span> <span class="p">:</span> <span class="n">public</span> <span class="n">CLxImpl_</span><span class="p">[[</span><span class="n">Undo</span> <span class="n">Interface</span><span class="o">|</span><span class="n">Undo</span><span class="p">]]</span>
 <span class="p">{</span>
     <span class="n">public</span><span class="p">:</span>
         <span class="n">std</span><span class="p">::</span><span class="n">string</span>  <span class="n">old_name</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>                 <span class="n">void</span>
         <span class="n">undo_Reverse</span> <span class="p">()</span>     <span class="n">LXx_OVERRIDE</span>
         <span class="p">{</span>
                 <span class="n">std</span><span class="p">::</span><span class="n">string</span>   <span class="n">temp</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>                 <span class="n">temp</span> <span class="o">=</span> <span class="n">global_string</span><span class="p">;</span>
                 <span class="n">global_string</span> <span class="o">=</span> <span class="n">old_name</span><span class="p">;</span>
                 <span class="n">old_name</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>
         <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>                 <span class="n">void</span>
         <span class="n">undo_Forward</span> <span class="p">()</span>     <span class="n">LXx_OVERRIDE</span>
         <span class="p">{</span>
                 <span class="n">undo_Reverse</span> <span class="p">();</span>
         <span class="p">}</span>
 <span class="p">};</span>
</pre></div>
</td></tr></table></div>
<p>You register your undo using the Undo service. First you have to allocate your undo object, which you can do with a Using a Spawner . This will give you both the <em>ILxUnknownID</em> for the COM object, and the pointer to your undo class. You then initialize the state of the new undo object and add it to the undo system.</p>
<p>This example changes the name and registers an undo action to change it back. In this case UndoService::Record() is used to register an undo action for a change that has already happened. Note that since we’re not using wrappers for the undo object we have to release it when done. The service has added its reference count so it won’t be deleted.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span>         <span class="n">void</span>
 <span class="n">SetGlobalName_Undoable</span> <span class="p">(</span>
         <span class="n">std</span><span class="p">::</span><span class="n">string</span>        <span class="o">&amp;</span><span class="n">name</span><span class="p">)</span>
 <span class="p">{</span>
         <span class="n">CLxUser_</span><span class="p">[[</span><span class="n">UndoService</span> <span class="n">Interface</span><span class="o">|</span><span class="n">UndoService</span><span class="p">]]</span> <span class="n">undoSvc</span><span class="p">;</span>
         <span class="n">CSwapName</span>          <span class="o">*</span><span class="n">undo</span><span class="p">;</span>
         <span class="n">ILxUnknownID</span>        <span class="n">obj</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>         <span class="n">undo</span> <span class="o">=</span> <span class="n">SpawnUndo</span> <span class="p">(</span><span class="n">obj</span><span class="p">);</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>         <span class="n">undo</span><span class="o">-&gt;</span><span class="n">old_name</span> <span class="o">=</span> <span class="n">global_string</span><span class="p">;</span>
         <span class="n">global_string</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>         <span class="n">undoSvc</span><span class="o">.</span><span class="n">Record</span> <span class="p">(</span><span class="n">obj</span><span class="p">);</span>
         <span class="n">lx</span><span class="p">::</span><span class="n">ObjRelease</span> <span class="p">(</span><span class="n">obj</span><span class="p">);</span>
 <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Because the action is a swap this function can be simplified by creating the action in an “undone” state. Adding it to the undo system by calling UndoService::Apply() performs the forward action and adds it to the system. This means there is only one implementation of the code that performs the swap.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span>         <span class="n">void</span>
 <span class="n">SetGlobalName_Undoable</span> <span class="p">(</span>
         <span class="n">std</span><span class="p">::</span><span class="n">string</span>        <span class="o">&amp;</span><span class="n">name</span><span class="p">)</span>
 <span class="p">{</span>
         <span class="n">CLxUser_</span><span class="p">[[</span><span class="n">UndoService</span> <span class="n">Interface</span><span class="o">|</span><span class="n">UndoService</span><span class="p">]]</span> <span class="n">undoSvc</span><span class="p">;</span>
         <span class="n">CSwapName</span>          <span class="o">*</span><span class="n">undo</span><span class="p">;</span>
         <span class="n">ILxUnknownID</span>        <span class="n">obj</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>         <span class="n">undo</span> <span class="o">=</span> <span class="n">SpawnUndo</span> <span class="p">(</span><span class="n">obj</span><span class="p">);</span>
         <span class="n">undo</span><span class="o">-&gt;</span><span class="n">old_name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>         <span class="n">undoSvc</span><span class="o">.</span><span class="n">Apply</span> <span class="p">(</span><span class="n">obj</span><span class="p">);</span>
         <span class="n">lx</span><span class="p">::</span><span class="n">ObjRelease</span> <span class="p">(</span><span class="n">obj</span><span class="p">);</span>
 <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>If the undoable change of state is as a result of your own command, then you know that it’s always OK to register undo actions. Sometimes your change of state is the result of something more indirect, such as listener events or other state-change methods. In that case you have to make sure that the event is not the result of the user undoing or redoing other changes, in which case it’s invalid to add undo events. This is easily tested with the undo service:</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="n">void</span> <span class="n">changeEvent</span> <span class="p">()</span>
 <span class="p">{</span>
         <span class="n">CLxUser_</span><span class="p">[[</span><span class="n">UndoService</span> <span class="n">Interface</span><span class="o">|</span><span class="n">UndoService</span><span class="p">]]</span>   <span class="n">undoSvc</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span>         <span class="k">if</span> <span class="p">(</span><span class="n">undoSvc</span><span class="o">.</span><span class="n">State</span> <span class="p">()</span> <span class="o">==</span> <span class="n">LXiUNDO_ACTIVE</span><span class="p">)</span>
                 <span class="n">performUndoableChange</span> <span class="p">();</span>
 <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>If you get an event when undos are active, you respond by changing your state and registering the undo. If, however, you get this same event notification as result of an undo you don’t have to change state or register undos. In that case your own undo action will already be fired as part of the same undo.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Selection%20System%20Overview.html" class="btn btn-neutral float-right" title="Selection System Overview" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Headless.html" class="btn btn-neutral float-left" title="Headless" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Foundry

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org/">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>

<!-- Mirrored from learn.foundry.com/modo/developers/latest/sdk/pages/general/systems/Interfacing with the Undo System.html by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 30 Nov 2024 03:15:52 GMT -->
</html>