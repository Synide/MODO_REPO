

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->

<!-- Mirrored from learn.foundry.com/modo/developers/latest/sdk/pages/tutorials/Command VertValue.html by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 30 Nov 2024 03:16:03 GMT -->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Command VertValue &mdash; Modo SDK 14.2v0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/js/contentui.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Creating a Selection Set" href="Creating%20a%20Selection%20Set.html" />
    <link rel="prev" title="Colormodel kelvin" href="Colormodel%20kelvin.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Modo SDK
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="https://learn.foundry.com/modo/developers/latest/sdk/search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Articles</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../starting/_starting.html">First Steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server_basics/_server_basics.html">Server Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general/_general.html">Editorial Info</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ui/_ui.html">User Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scripting/_scripting.html">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faqs/_faqs.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption"><span class="caption-text">Code Examples</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="_tutorials.html">SDK Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Channel%20Mod%20Linear%20Blend.html">Channel Mod Linear Blend</a></li>
<li class="toctree-l2"><a class="reference internal" href="Channel%20Mod%20Math%20Multi.html">Channel Mod Math Multi</a></li>
<li class="toctree-l2"><a class="reference internal" href="Channel%20Mod%20Simple%20Kinematics.html">Channel Mod Simple Kinematics</a></li>
<li class="toctree-l2"><a class="reference internal" href="Color%20Model%20HSV.html">Color Model HSV</a></li>
<li class="toctree-l2"><a class="reference internal" href="Colormodel%20kelvin.html">Colormodel kelvin</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Command VertValue</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#functionality">Functionality</a></li>
<li class="toctree-l3"><a class="reference internal" href="#code-walkthrough">Code Walkthrough</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#vertvalue-cpp">VertValue.cpp</a></li>
<li class="toctree-l4"><a class="reference internal" href="#instsrc-cpp">instsrc.cpp</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Creating%20a%20Selection%20Set.html">Creating a Selection Set</a></li>
<li class="toctree-l2"><a class="reference internal" href="CustomView.html">CustomView</a></li>
<li class="toctree-l2"><a class="reference internal" href="Hello%20World.html">Hello World</a></li>
<li class="toctree-l2"><a class="reference internal" href="HostService%20Reference.html">HostService Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="Io%20image%20raw.html">Io image raw</a></li>
<li class="toctree-l2"><a class="reference internal" href="Io%20scene%20geo.html">Io scene geo</a></li>
<li class="toctree-l2"><a class="reference internal" href="Io%20scene%20hgpl.html">Io scene hgpl</a></li>
<li class="toctree-l2"><a class="reference internal" href="Item%20Command%20Arguments.html">Item Command Arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="Item%20gasket.html">Item gasket</a></li>
<li class="toctree-l2"><a class="reference internal" href="Item%20mandelbrot.html">Item mandelbrot</a></li>
<li class="toctree-l2"><a class="reference internal" href="Item%20orb.html">Item orb</a></li>
<li class="toctree-l2"><a class="reference internal" href="Language%20Wrappers.html">Language Wrappers</a></li>
<li class="toctree-l2"><a class="reference internal" href="Mesh%20Operation%20-%20Automatic%20implementation.html">Mesh Operation - Automatic implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Mesh%20Operation%20-%20Example.html">Mesh Operation - Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="Mesh%20Operation%20-%20Manual%20implementation.html">Mesh Operation - Manual implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Modo%20Version%20History.html">Modo Version History</a></li>
<li class="toctree-l2"><a class="reference internal" href="Movie%20cocoaqt.html">Movie cocoaqt</a></li>
<li class="toctree-l2"><a class="reference internal" href="Multiple%20Servers%20in%20One%20Module.html">Multiple Servers in One Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="Network%20Rendering.html">Network Rendering</a></li>
<li class="toctree-l2"><a class="reference internal" href="Package%20or%20Item%20Type%20(metaclass).html">Package or Item Type (metaclass)</a></li>
<li class="toctree-l2"><a class="reference internal" href="Path%20Aliases.html">Path Aliases</a></li>
<li class="toctree-l2"><a class="reference internal" href="Pattern%20Matching.html">Pattern Matching</a></li>
<li class="toctree-l2"><a class="reference internal" href="PlatformService%20Reference.html">PlatformService Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="Plug-ins%20vs.%20Scripts.html">Plug-ins vs. Scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="Pop-up%20List%20Choice.html">Pop-up List Choice</a></li>
<li class="toctree-l2"><a class="reference internal" href="Preference%20Forms.html">Preference Forms</a></li>
<li class="toctree-l2"><a class="reference internal" href="Prepare_Evaluate%20Protocol.html">Prepare/Evaluate Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="Preset%20Browser%20Filtering.html">Preset Browser Filtering</a></li>
<li class="toctree-l2"><a class="reference internal" href="Preset%20Browser%20Paths.html">Preset Browser Paths</a></li>
<li class="toctree-l2"><a class="reference internal" href="Preview%20Socket.html">Preview Socket</a></li>
<li class="toctree-l2"><a class="reference internal" href="Procedural%20Geometry.html">Procedural Geometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="Python.html">Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="Python%20API%20Overview.html">Python API Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="Python%20Command%20Overview.html">Python Command Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="Python%20Notifier%20Example.html">Python Notifier Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="Python%20Samples.html">Python Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="Python%20Treeview%20Example.html">Python Treeview Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="Python%20in%20Modo.html">Python in Modo</a></li>
<li class="toctree-l2"><a class="reference internal" href="Query%20Command%20Values%20example.html">Query Command Values example</a></li>
<li class="toctree-l2"><a class="reference internal" href="RandomSel%20Script.html">RandomSel Script</a></li>
<li class="toctree-l2"><a class="reference internal" href="Reading%20Files%20with%20Python.html">Reading Files with Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="Reading%20Persistant%20Data.html">Reading Persistant Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="Reading%20UV%20Values.html">Reading UV Values in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="Render%20Frame%20Size.html">Render Frame Size</a></li>
<li class="toctree-l2"><a class="reference internal" href="Scene%20Query.cpp.html">Scene Query.cpp</a></li>
<li class="toctree-l2"><a class="reference internal" href="Select.typeFrom.html">Select.typeFrom</a></li>
<li class="toctree-l2"><a class="reference internal" href="Selection%20Operation%20-%20Automatic%20implementation.html">Selection Operation - Automatic implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Selection%20Operation%20-%20Manual%20implementation.html">Selection Operation - Manual implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Server%20Tags.html">Server Tags</a></li>
<li class="toctree-l2"><a class="reference internal" href="Singleton%20Listener.html">Singleton Listener</a></li>
<li class="toctree-l2"><a class="reference internal" href="Singleton%20Polymorph.html">Singleton Polymorph</a></li>
<li class="toctree-l2"><a class="reference internal" href="Startup%20Commands.html">Startup Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="Symbols%20defined%20in%20the%20lx%20package.html">Symbols defined in the lx package</a></li>
<li class="toctree-l2"><a class="reference internal" href="Texture%20test.html">Texture test</a></li>
<li class="toctree-l2"><a class="reference internal" href="Tool%20spikey.html">Tool spikey</a></li>
<li class="toctree-l2"><a class="reference internal" href="Using%20Loader%20Options.html">Using Loader Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="Writing%20to%20the%20Event%20Log.html">Writing to the Event Log</a></li>
<li class="toctree-l2"><a class="reference internal" href="Writing%20to%20the%20modo%20event%20log%20and%20debugger.html">Writing to the modo event log and debugger</a></li>
<li class="toctree-l2"><a class="reference internal" href="Your%20First%20Tool%20in%20Modo.html">Your First Tool in Modo</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples/_examples.html">Code Examples and Snippets</a></li>
</ul>
<p class="caption"><span class="caption-text">Technical Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../python/python.html">Python Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cpp/cpp.html">C++ Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Modo SDK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="_tutorials.html">SDK Tutorials</a> &raquo;</li>
        
      <li>Command VertValue</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="command-vertvalue">
<h1>Command VertValue<a class="headerlink" href="#command-vertvalue" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#functionality" id="id5">Functionality</a></p></li>
<li><p><a class="reference internal" href="#code-walkthrough" id="id6">Code Walkthrough</a></p>
<ul>
<li><p><a class="reference internal" href="#vertvalue-cpp" id="id7">VertValue.cpp</a></p>
<ul>
<li><p><a class="reference internal" href="#class-declarations" id="id8">Class Declarations</a></p></li>
<li><p><a class="reference internal" href="#initialize-index" id="id9"><span class="xref std std-doc">./Initialize_(index)</span></a></p></li>
<li><p><a class="reference internal" href="#helper-functions" id="id10">Helper Functions</a></p></li>
<li><p><a class="reference internal" href="#implementations" id="id11">Implementations</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#instsrc-cpp" id="id12">instsrc.cpp</a></p>
<ul>
<li><p><a class="reference internal" href="#id1" id="id13">Class Declarations</a></p></li>
<li><p><a class="reference internal" href="#id2" id="id14"><span class="xref std std-doc">./Initialize_(index)</span></a></p></li>
<li><p><a class="reference internal" href="#id3" id="id15">Helper Functions</a></p></li>
<li><p><a class="reference internal" href="#id4" id="id16">Implementations</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<p>Command VertValue is a basic example plugin. This wiki page is intended as a walkthrough of the code in order to help you better understand the SDK.</p>
<div class="section" id="functionality">
<h2><a class="toc-backref" href="#id5">Functionality</a><a class="headerlink" href="#functionality" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="code-walkthrough">
<h2><a class="toc-backref" href="#id6">Code Walkthrough</a><a class="headerlink" href="#code-walkthrough" title="Permalink to this headline">¶</a></h2>
<div class="section" id="vertvalue-cpp">
<h3><a class="toc-backref" href="#id7">VertValue.cpp</a><a class="headerlink" href="#vertvalue-cpp" title="Permalink to this headline">¶</a></h3>
<div class="section" id="class-declarations">
<h4><a class="toc-backref" href="#id8">Class Declarations</a><a class="headerlink" href="#class-declarations" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CPersistData</span> <span class="p">{</span>
    <span class="n">public</span><span class="p">:</span>
        <span class="n">CLxUser_PersistentEntry</span>  <span class="n">mainHash</span><span class="p">;</span>
        <span class="n">CLxUser_PersistentEntry</span>  <span class="n">atom</span><span class="p">;</span>
        <span class="n">CLxUser_PersistentEntry</span>  <span class="nb">hash</span><span class="p">;</span>
        <span class="n">CLxUser_PersistentEntry</span>  <span class="nb">list</span><span class="p">;</span>

        <span class="n">CLxUser_Attributes</span>       <span class="n">aVal</span><span class="p">;</span>
        <span class="n">CLxUser_Attributes</span>       <span class="n">hVal</span><span class="p">;</span>
        <span class="n">CLxUser_Attributes</span>       <span class="n">lVal</span><span class="p">;</span>

        <span class="n">void</span>             <span class="n">GenIndex</span> <span class="p">();</span>
        <span class="n">void</span>             <span class="n">Peek</span> <span class="p">();</span>
        <span class="n">void</span>             <span class="n">Poke</span> <span class="p">(</span><span class="nb">int</span> <span class="n">comp</span><span class="p">,</span> <span class="n">double</span> <span class="n">value</span><span class="p">,</span> <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">name</span><span class="p">);</span>
        <span class="n">char</span>             <span class="n">index_buf</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="p">};</span>
</pre></div>
</td></tr></table></div>
<p>This class is largely a shell to store persistent data entries. All of the relevant structures we already have access to thanks to our inclusion of lx_persist.hpp and lx_value.hpp</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="k">class</span> <span class="nc">CPersistVisitor</span> <span class="p">:</span> <span class="n">public</span> <span class="n">CLxImpl_AbstractVisitor</span>
 <span class="p">{</span>
    <span class="n">public</span><span class="p">:</span>
        <span class="n">LxResult</span>         <span class="n">Evaluate</span> <span class="p">();</span>
 <span class="p">};</span>
</pre></div>
</td></tr></table></div>
<p>The structure of persistent data is set up using a vistor. This allows the system to bracket the setup with its own state management. The structure is created is as follows:</p>
<p>root TestData</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>          <span class="nb">hash</span> <span class="n">MainHash</span>
            <span class="n">atom</span> <span class="n">FloatAtom</span> <span class="o">%</span><span class="n">f</span>
            <span class="nb">hash</span> <span class="n">IntHash</span> <span class="o">%</span><span class="n">d</span>
            <span class="nb">list</span> <span class="n">StringList</span> <span class="o">%</span><span class="n">s</span>
</pre></div>
</td></tr></table></div>
<p>In order to turn out class into a visitor, though, we need to inherit from <span class="xref std std-doc">./Visitor_(lx-visitor.hpp)</span>, which has all the necessary methods.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CVertexSelectionVisitor</span> <span class="p">:</span> <span class="n">public</span> <span class="n">CLxImpl_AbstractVisitor</span>
<span class="p">{</span>
    <span class="n">public</span><span class="p">:</span>
        <span class="n">virtual</span> <span class="n">void</span> <span class="n">StartMesh</span>  <span class="p">(</span><span class="k">class</span> <span class="nc">CVertexCompCommand</span> <span class="o">&amp;</span><span class="p">)</span>  <span class="p">{}</span>
        <span class="n">virtual</span> <span class="nb">bool</span> <span class="n">Vertex</span>     <span class="p">(</span><span class="k">class</span> <span class="nc">CVertexCompCommand</span> <span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">class</span> <span class="nc">CVertexCompCommand</span>        <span class="o">*</span><span class="n">m_cvc</span><span class="p">;</span>
        <span class="n">void</span> <span class="n">init</span> <span class="p">(</span><span class="k">class</span> <span class="nc">CVertexCompCommand</span> <span class="o">*</span><span class="n">cvc</span><span class="p">)</span>
        <span class="p">{</span>
                <span class="n">m_cvc</span> <span class="o">=</span> <span class="n">cvc</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">LxResult</span> <span class="n">Evaluate</span> <span class="p">()</span>
        <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">Vertex</span> <span class="p">(</span><span class="o">*</span><span class="n">m_cvc</span><span class="p">))</span>
                        <span class="k">return</span> <span class="n">LXe_ABORT</span><span class="p">;</span>
                <span class="k">else</span>
                        <span class="k">return</span> <span class="n">LXe_OK</span><span class="p">;</span>
        <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</td></tr></table></div>
<p>This command will operate over selected vertices, so we have a specialized version of a visitor for processing them. To turn this class into a visitor we will inherit from CLxImpl_AbstractVisitor. StartMesh() is called when we enter a new mesh (if multiple meshes are selected) and Vertex() is called for each vertex. Vertex() can return true to halt the enumeration.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CVertexCompCommand</span> <span class="p">:</span> <span class="n">public</span> <span class="n">CLxBasicCommand</span>
<span class="p">{</span>
    <span class="n">public</span><span class="p">:</span>
         <span class="n">CVertexCompCommand</span> <span class="p">();</span>

        <span class="nb">int</span>             <span class="n">basic_CmdFlags</span>  <span class="p">()</span> <span class="n">LXx_OVERRIDE</span><span class="p">;</span>
        <span class="nb">bool</span>            <span class="n">basic_Notifier</span>  <span class="p">(</span><span class="nb">int</span> <span class="n">index</span><span class="p">,</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">name</span><span class="p">,</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">args</span><span class="p">)</span> <span class="n">LXx_OVERRIDE</span><span class="p">;</span>
        <span class="n">const</span> <span class="n">char</span> <span class="o">*</span>    <span class="n">basic_ArgType</span>   <span class="p">(</span><span class="n">unsigned</span> <span class="nb">int</span> <span class="n">index</span><span class="p">)</span> <span class="n">LXx_OVERRIDE</span><span class="p">;</span>
        <span class="nb">bool</span>            <span class="n">basic_Enable</span>    <span class="p">(</span><span class="n">CLxUser_Message</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span> <span class="n">LXx_OVERRIDE</span><span class="p">;</span>

        <span class="n">void</span>            <span class="n">cmd_Execute</span>     <span class="p">(</span><span class="n">unsigned</span> <span class="nb">int</span> <span class="n">flags</span><span class="p">)</span> <span class="n">LXx_OVERRIDE</span><span class="p">;</span>
        <span class="n">LxResult</span>        <span class="n">cmd_Query</span>       <span class="p">(</span><span class="n">unsigned</span> <span class="nb">int</span> <span class="n">index</span><span class="p">,</span> <span class="n">ILxUnknownID</span> <span class="n">vaQuery</span><span class="p">)</span> <span class="n">LXx_OVERRIDE</span><span class="p">;</span>

        <span class="nb">bool</span>            <span class="n">GetVMap</span>         <span class="p">();</span>
        <span class="n">void</span>            <span class="n">Enumerate</span>       <span class="p">(</span><span class="n">CVertexSelectionVisitor</span> <span class="o">&amp;</span><span class="p">,</span> <span class="nb">bool</span> <span class="n">edit</span> <span class="o">=</span> <span class="n">false</span><span class="p">);</span>

        <span class="n">CLxUser_MeshService</span>              <span class="n">srv_mesh</span><span class="p">;</span>
        <span class="n">CLxUser_LayerService</span>             <span class="n">srv_lay</span><span class="p">;</span>
        <span class="n">CLxUser_SelectionService</span>         <span class="n">srv_sel</span><span class="p">;</span>
        <span class="n">CLxUser_VMapPacketTranslation</span>    <span class="n">pkt_vmap</span><span class="p">;</span>
        <span class="n">LXtID4</span>                           <span class="n">selID_vmap</span><span class="p">,</span> <span class="n">selID_vert</span><span class="p">;</span>
        <span class="n">LXtMarkMode</span>                      <span class="n">select_mode</span><span class="p">;</span>

        <span class="n">const</span> <span class="n">char</span>                      <span class="o">*</span><span class="n">cm_name</span><span class="p">;</span>
        <span class="n">LXtID4</span>                           <span class="n">cm_type</span><span class="p">;</span>
        <span class="n">unsigned</span>                         <span class="n">cm_dim</span><span class="p">;</span>
        <span class="n">unsigned</span>                         <span class="n">cm_change</span><span class="p">;</span>

        <span class="n">CLxUser_Mesh</span>                     <span class="n">cm_mesh</span><span class="p">;</span>
        <span class="n">CLxUser_Point</span>                    <span class="n">cm_point</span><span class="p">;</span>
        <span class="n">LXtMeshMapID</span>                     <span class="n">cm_mapID</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</td></tr></table></div>
<p>This class will be performing actions on Modo, so we need to make it a basic command; to make it a <span class="xref std std-doc">./Command_(lx-command.hpp)#Command_Objects</span> we inherit from CLxBasicCommand.</p>
</div>
<div class="section" id="initialize-index">
<h4><a class="toc-backref" href="#id9"><span class="xref std std-doc">./Initialize_(index)</span></a><a class="headerlink" href="#initialize-index" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="n">void</span> <span class="n">initialize</span> <span class="p">()</span>
 <span class="p">{</span>
        <span class="n">CLxGenericPolymorph</span>     <span class="o">*</span><span class="n">srv</span><span class="p">;</span>

        <span class="n">srv</span> <span class="o">=</span> <span class="n">new</span> <span class="n">CLxPolymorph</span><span class="o">&lt;</span><span class="n">CVertexCompCommand</span><span class="o">&gt;</span><span class="p">;</span>
        <span class="n">srv</span><span class="o">-&gt;</span><span class="n">AddInterface</span> <span class="p">(</span><span class="n">new</span> <span class="n">CLxIfc_Command</span>     <span class="o">&lt;</span><span class="n">CVertexCompCommand</span><span class="o">&gt;</span><span class="p">);</span>
        <span class="n">srv</span><span class="o">-&gt;</span><span class="n">AddInterface</span> <span class="p">(</span><span class="n">new</span> <span class="n">CLxIfc_Attributes</span>  <span class="o">&lt;</span><span class="n">CVertexCompCommand</span><span class="o">&gt;</span><span class="p">);</span>
        <span class="n">srv</span><span class="o">-&gt;</span><span class="n">AddInterface</span> <span class="p">(</span><span class="n">new</span> <span class="n">CLxIfc_AttributesUI</span><span class="o">&lt;</span><span class="n">CVertexCompCommand</span><span class="o">&gt;</span><span class="p">);</span>
        <span class="n">lx</span><span class="p">::</span><span class="n">AddServer</span> <span class="p">(</span><span class="s2">&quot;vertex.componentValue&quot;</span><span class="p">,</span> <span class="n">srv</span><span class="p">);</span>

        <span class="n">init_InstanceSource</span> <span class="p">();</span>
 <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>This initialize function indicates that we will be exporting one server, dependent on the CVertexCompCommand, that will have all the interfaces corresponding to the classes that CVertexCompCommand inherited from. The name of this server will be vertex.componentValue.</p>
</div>
<div class="section" id="helper-functions">
<h4><a class="toc-backref" href="#id10">Helper Functions</a><a class="headerlink" href="#helper-functions" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span>        <span class="n">static</span> <span class="n">void</span>
 <span class="n">Persist_Setup</span> <span class="p">(</span><span class="n">void</span><span class="p">)</span>
 <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pd</span><span class="p">)</span>
                <span class="k">return</span><span class="p">;</span>

        <span class="n">pd</span> <span class="o">=</span> <span class="n">new</span> <span class="n">CPersistData</span><span class="p">;</span>

        <span class="n">CLxUser_PersistenceService</span> <span class="n">srv</span><span class="p">;</span>
        <span class="n">CPersistVisitor</span>          <span class="n">vis</span><span class="p">;</span>

        <span class="n">srv</span><span class="o">.</span><span class="n">ConfigureVis</span> <span class="p">(</span><span class="s2">&quot;TestData&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vis</span><span class="p">);</span>
 <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>This function performs setup on a number of key services; this happens once per session.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="n">void</span> <span class="n">cleanup</span> <span class="p">()</span>
 <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pd</span><span class="p">)</span>
                <span class="n">delete</span> <span class="n">pd</span><span class="p">;</span>
 <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>This function cleans up the persistent data set up by Persist_Setup.</p>
</div>
<div class="section" id="implementations">
<h4><a class="toc-backref" href="#id11">Implementations</a><a class="headerlink" href="#implementations" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="c1">#define ARGi_COMP               0</span>
 <span class="c1">#define ARGi_VALUE         1</span>
 <span class="c1">#define ARGi_TYPE               2</span>
</pre></div>
</td></tr></table></div>
<p>These are command argument indices that are used in the constructor below.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">CVertexCompCommand</span><span class="p">::</span><span class="n">CVertexCompCommand</span> <span class="p">()</span>
<span class="p">{</span>
        <span class="n">CLxUser_SelectionType</span>            <span class="n">styp</span><span class="p">;</span>

        <span class="n">Persist_Setup</span> <span class="p">();</span>

        <span class="n">dyna_Add</span> <span class="p">(</span><span class="s2">&quot;component&quot;</span><span class="p">,</span> <span class="n">LXsTYPE_INTEGER</span><span class="p">);</span>
        <span class="n">dyna_Add</span> <span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>     <span class="n">LXsTYPE_FLOAT</span><span class="p">);</span>
        <span class="n">dyna_Add</span> <span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span>      <span class="n">LXsTYPE_STRING</span><span class="p">);</span>

        <span class="n">basic_SetFlags</span> <span class="p">(</span><span class="n">ARGi_VALUE</span><span class="p">,</span> <span class="n">LXfCMDARG_QUERY</span> <span class="o">|</span> <span class="n">LXfCMDARG_VARIABLE</span><span class="p">);</span>
        <span class="n">basic_SetFlags</span> <span class="p">(</span><span class="n">ARGi_TYPE</span><span class="p">,</span>  <span class="n">LXfCMDARG_OPTIONAL</span><span class="p">);</span>

        <span class="n">selID_vmap</span> <span class="o">=</span> <span class="n">srv_sel</span><span class="o">.</span><span class="n">LookupType</span> <span class="p">(</span><span class="s2">&quot;vmap&quot;</span><span class="p">);</span>
        <span class="n">srv_sel</span><span class="o">.</span><span class="n">GetImplementation</span> <span class="p">(</span><span class="n">selID_vmap</span><span class="p">,</span> <span class="n">styp</span><span class="p">);</span>
        <span class="n">pkt_vmap</span><span class="o">.</span><span class="n">set</span> <span class="p">(</span><span class="n">styp</span><span class="p">);</span>

        <span class="n">selID_vert</span> <span class="o">=</span> <span class="n">srv_sel</span><span class="o">.</span><span class="n">LookupType</span> <span class="p">(</span><span class="s2">&quot;vertex&quot;</span><span class="p">);</span>

        <span class="n">select_mode</span> <span class="o">=</span> <span class="n">srv_mesh</span><span class="o">.</span><span class="n">SetMode</span> <span class="p">(</span><span class="s2">&quot;select&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Setting up our command requires first initializing the arguments. They are added to the dynamic attributes and their flags are set. We also look up some selection types and the mode for selected elements.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span>      <span class="nb">int</span>
<span class="n">CVertexCompCommand</span><span class="p">::</span><span class="n">basic_CmdFlags</span> <span class="p">()</span>
<span class="p">{</span>
        <span class="k">return</span> <span class="n">LXfCMD_MODEL</span> <span class="o">|</span> <span class="n">LXfCMD_UNDO</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Basic_CmdFlags indicates what type of command  it is. MODEL means that it affects the data model of the scene, in this case the meshes, and UNDO means that it supports undo.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span></span>        <span class="nb">bool</span>
<span class="n">CVertexCompCommand</span><span class="p">::</span><span class="n">basic_Notifier</span> <span class="p">(</span>
        <span class="nb">int</span>                      <span class="n">index</span><span class="p">,</span>
        <span class="n">string</span>                  <span class="o">&amp;</span><span class="n">name</span><span class="p">,</span>
        <span class="n">string</span>                  <span class="o">&amp;</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;select.event&quot;</span><span class="p">;</span>
                <span class="n">args</span> <span class="o">=</span> <span class="s2">&quot;vmap +vdt&quot;</span><span class="p">;</span>             <span class="o">//</span> <span class="n">VALUE</span><span class="o">+</span><span class="n">DISABLE</span><span class="o">+</span><span class="n">TYPE</span> <span class="n">on</span> <span class="n">vmap</span> <span class="n">selection</span>

        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;select.event&quot;</span><span class="p">;</span>
                <span class="n">args</span> <span class="o">=</span> <span class="s2">&quot;vertex exist+d&quot;</span><span class="p">;</span>        <span class="o">//</span> <span class="n">DISABLE</span> <span class="n">on</span> <span class="n">vertex</span> <span class="n">selection</span> <span class="n">existence</span>

        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;select.event&quot;</span><span class="p">;</span>
                <span class="n">args</span> <span class="o">=</span> <span class="s2">&quot;vertex +v&quot;</span><span class="p">;</span>             <span class="o">//</span> <span class="n">VALUE</span> <span class="n">on</span> <span class="n">vertex</span> <span class="n">selection</span> <span class="n">change</span>

        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;meshes.event&quot;</span><span class="p">;</span>
                <span class="n">args</span> <span class="o">=</span> <span class="s2">&quot;+ouma +v&quot;</span><span class="p">;</span>              <span class="o">//</span> <span class="n">VALUE</span> <span class="n">on</span> <span class="n">position</span><span class="p">(</span><span class="n">o</span><span class="p">),</span> <span class="n">UV</span> <span class="nb">map</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">morph</span> <span class="nb">map</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="ow">and</span> <span class="n">other</span> <span class="nb">map</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="n">edits</span>

        <span class="p">}</span> <span class="k">else</span>
                <span class="k">return</span> <span class="n">false</span><span class="p">;</span>

        <span class="k">return</span> <span class="n">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Notifiers are used to signal changes to a command’s state to any client that may be using it. For example a command in a form may be disabled. If something changes in the system that changes the disable state, we need a notifier so that the form will be triggered to update. This method on the basic command is called with sequentially higher index values until it returns false. As long as it returns true it will add more notifiers.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre></div></td><td class="code"><div class="highlight"><pre><span></span>     bool
CVertexCompCommand::GetVMap ()
{
        void                    *pkt;

        /*
         * If the &#39;type&#39; argument is unset, we just take the most recent vmap
         * selection and read it&#39;s name and type.
         */
        if (!dyna_IsSet (ARGi_TYPE)) {
                pkt = srv_sel.Recent (selID_vmap);
                if (!pkt)
                        return false;

                pkt_vmap.Name (pkt, &amp;cm_name);
                pkt_vmap.Type (pkt, &amp;cm_type);
                return true;
        }

        /*
         * If the type is set, we decode it and then walk the selection to find
         * a map that fits the request.
         */
        string                   typeStr;
        LXtID4                   type;
        unsigned                 i, n;

        attr_GetString (ARGi_TYPE, typeStr);
        if (LXx_FAIL (srv_mesh.VMapLookupType (typeStr.c_str (), &amp;type)))
                return false;

        n = srv_sel.Count (selID_vmap);
        for (i = 0; i &lt; n; i++) {
                pkt = srv_sel.ByIndex (selID_vmap, i);

                pkt_vmap.Type (pkt, &amp;cm_type);
                if (cm_type != type)
                        continue;

                pkt_vmap.Name (pkt, &amp;cm_name);
                return true;
        }

        return false;
}
</pre></div>
</td></tr></table></div>
<p>This method selects a map based on the state of the command. If it returns true then ‘cm_name’ and ‘cm_type’ have been successfully set.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58</pre></div></td><td class="code"><div class="highlight"><pre><span></span>        void
CVertexCompCommand::Enumerate (
        CVertexSelectionVisitor &amp;vsv,
        bool                     edit)
{
        CLxUser_LayerScan        scan;
        unsigned                 i, n;

        if (!srv_sel.Count (selID_vert))
                return;

        if (!GetVMap ())
                return;

        srv_mesh.VMapDimension (cm_type, &amp;cm_dim);
        if (cm_type == LXi_VMAP_OBJECTPOS)
                cm_change = LXf_MESHEDIT_POSITION;
        else if (cm_type == LXi_VMAP_TEXTUREUV)
                cm_change = LXf_MESHEDIT_MAP_UV;
        else if (cm_type == LXi_VMAP_MORPH || cm_type == LXi_VMAP_SPOT)
                cm_change = LXf_MESHEDIT_MAP_MORPH;
        else
                cm_change = LXf_MESHEDIT_MAP_OTHER;

        n = LXf_LAYERSCAN_ACTIVE | LXf_LAYERSCAN_MARKVERTS;
        if (edit)
                n |= LXf_LAYERSCAN_WRITEMESH;

        if (!srv_lay.BeginScan (n, scan))
                return;

        vsv.init (this);

        n = scan.NumLayers ();
        for (i = 0; i &lt; n; i++) {
                if (edit)
                        scan.EditMeshByIndex (i, cm_mesh);
                else
                        scan.BaseMeshByIndex (i, cm_mesh);

                CLxUser_MeshMap mmap (cm_mesh);
                mmap.SelectByName (cm_type, cm_name);
                cm_mapID = mmap.ID ();

                vsv.StartMesh (*this);

                cm_point.fromMeshObj (cm_mesh);
                cm_point.Enum (&amp;vsv, select_mode);

                // the POINTS flag shouldn&#39;t be needed (bug 22347)
                //
                if (edit)
                        scan.SetMeshChange (i, LXf_MESHEDIT_POINTS | cm_change);
        }

        if (edit)
                scan.Apply ();
}
</pre></div>
</td></tr></table></div>
<p>This is a core utility function that enumerates selected vertices with our custom visitor. This uses a layer scan object created by the layer service. Since this obeys the normal rule that if no points are seelcted all are selected, we test the selection explicitly so we do nothing when there is no explicit selection.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span>        bool
CVertexCompCommand::basic_Enable (
        CLxUser_Message         &amp;msg)
{
        CEnableVisitor           vis;
        int                      comp;

        vis.any = false;
        Enumerate (vis);

        if (!vis.any)
                return false;

        if (!dyna_IsSet (ARGi_COMP))
                return true;

        attr_GetInt (ARGi_COMP, &amp;comp);
        return (comp &gt;= 0 &amp;&amp; comp &lt; static_cast&lt;int&gt;(cm_dim));
}
</pre></div>
</td></tr></table></div>
<p>We’re disabled if there is nothing to operate on. Otherwise we want to be enabled if the ‘component’ arg is unset (to open a full dialog). If set, it has to be smaller than the map dimension.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span>       const char *
CVertexCompCommand::basic_ArgType (
        unsigned int             index)
{
        if (!GetVMap ())
                return LXsTYPE_FLOAT;

        if (cm_type == LXi_VMAP_TEXTUREUV)
                return LXsTYPE_UVCOORD;

        if (cm_type == LXi_VMAP_WEIGHT)
                return LXsTYPE_PERCENT;

        if (cm_type == LXi_VMAP_MORPH || cm_type == LXi_VMAP_SPOT)
                return LXsTYPE_DISTANCE;

        if (cm_type == LXi_VMAP_RGBA  || cm_type == LXi_VMAP_RGB)
                return LXsTYPE_COLOR1;

        return LXsTYPE_FLOAT;
}
</pre></div>
</td></tr></table></div>
<p>This method will be called to get the type of the variable argument type, which in our case is the ‘type’ argument. ‘index’ will be ARGi_VALUE, so we don’t really have to test that. We pick a datatype appropriate for the map type.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span>        <span class="n">LxResult</span>
<span class="n">CVertexCompCommand</span><span class="p">::</span><span class="n">cmd_Query</span> <span class="p">(</span>
        <span class="n">unsigned</span> <span class="nb">int</span>             <span class="n">index</span><span class="p">,</span>
        <span class="n">ILxUnknownID</span>             <span class="n">vaQuery</span><span class="p">)</span>
<span class="p">{</span>
        <span class="n">CQueryVisitor</span>            <span class="n">vis</span><span class="p">;</span>

        <span class="n">vis</span><span class="o">.</span><span class="n">va</span><span class="o">.</span><span class="n">set</span> <span class="p">(</span><span class="n">vaQuery</span><span class="p">);</span>
        <span class="n">attr_GetInt</span> <span class="p">(</span><span class="n">ARGi_COMP</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vis</span><span class="o">.</span><span class="n">comp</span><span class="p">);</span>

        <span class="n">Enumerate</span> <span class="p">(</span><span class="n">vis</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">LXe_OK</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>This command creates an array that holds objects of value ARGi_COMP.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span>        <span class="n">void</span>
<span class="n">CVertexCompCommand</span><span class="p">::</span><span class="n">cmd_Execute</span> <span class="p">(</span>
        <span class="n">unsigned</span> <span class="nb">int</span>             <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
        <span class="n">CApplyVisitor</span>            <span class="n">vis</span><span class="p">;</span>

        <span class="n">attr_GetInt</span> <span class="p">(</span><span class="n">ARGi_COMP</span><span class="p">,</span>  <span class="o">&amp;</span><span class="n">vis</span><span class="o">.</span><span class="n">comp</span><span class="p">);</span>
        <span class="n">attr_GetFlt</span> <span class="p">(</span><span class="n">ARGi_VALUE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vis</span><span class="o">.</span><span class="n">value</span><span class="p">);</span>

        <span class="n">Enumerate</span> <span class="p">(</span><span class="n">vis</span><span class="p">,</span> <span class="n">true</span><span class="p">);</span>

        <span class="n">basic_Message</span><span class="p">()</span><span class="o">.</span><span class="n">SetCode</span> <span class="p">(</span><span class="n">LXe_OK</span><span class="p">);</span>

        <span class="o">/*</span>
         <span class="o">*</span> <span class="n">Test</span> <span class="n">persistent</span> <span class="n">data</span> <span class="n">by</span> <span class="n">recording</span> <span class="n">executions</span><span class="o">.</span>
         <span class="o">*/</span>
        <span class="n">pd</span><span class="o">-&gt;</span><span class="n">GenIndex</span> <span class="p">();</span>
        <span class="n">pd</span><span class="o">-&gt;</span><span class="n">Peek</span> <span class="p">();</span>
        <span class="n">pd</span><span class="o">-&gt;</span><span class="n">Poke</span> <span class="p">(</span><span class="n">vis</span><span class="o">.</span><span class="n">comp</span><span class="p">,</span> <span class="n">vis</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">cm_name</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>The cmd_Execute function is executed when the plugin is run. We retrieve the values given to ARGi_COMP and ARGi_VALUE. We then test persistent data by recording executions.</p>
</div>
</div>
<div class="section" id="instsrc-cpp">
<h3><a class="toc-backref" href="#id12">instsrc.cpp</a><a class="headerlink" href="#instsrc-cpp" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id1">
<h4><a class="toc-backref" href="#id13">Class Declarations</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99</pre></div></td><td class="code"><div class="highlight"><pre><span></span>class CItemVisitor
{
    public:
        virtual bool    Item (CLxUser_Item &amp;item) = 0;
};
class CItemSelectionTracker :
                public CItemVisitor,
                public CLxImpl_SelectionListener,
                public CLxSingletonPolymorph
{
    public:
        CLxUser_SceneService             srv_scene;
        CLxUser_SelectionService         srv_sel;
        CLxUser_ItemPacketTranslation    pkt_item;
        LXtID4                           selID_item;
        bool                             is_valid;
        unsigned                         use_count;
        std::set&lt;LXtItemType&gt;            cur_types;

        LXxSINGLETON_METHOD;

        CItemSelectionTracker ()
        {
                is_valid  = false;
                use_count = 1;

                AddInterface (new CLxIfc_SelectionListener&lt;CItemSelectionTracker&gt;);

                selID_item = srv_sel.LookupType (&quot;item&quot;);
                pkt_item.autoInit ();
        }

                void
        selevent_Add (
                LXtID4                   type,
                unsigned int             subtype)
                                         LXx_OVERRIDE
        {
                if (type == selID_item)
                        is_valid = false;
        }

                void
        selevent_Remove (
                LXtID4                   type,
                unsigned int             subtype)
                                         LXx_OVERRIDE
        {
                if (type == selID_item)
                        is_valid = false;
        }

                void
        Enumerate (
                CItemVisitor            &amp;vis)
        {
                CLxUser_Item             item;
                LXtScanInfoID            scan;
                void                    *pkt;

                scan = 0;
                while (scan = srv_sel.ScanLoopCurrent (scan, selID_item, &amp;pkt)) {
                        pkt_item.GetItem (pkt, item);
                        if (vis.Item (item))
                                return;
                }
        }

                void
        ValidateTypeSet ()
        {
                cur_types.clear ();
                Enumerate (*this);
        }

                bool
        Item (
                CLxUser_Item            &amp;item)
        {
                cur_types.insert (item.Type ());
                return false;
        }

                bool
        AllowType (
                LXtItemType              type)
        {
                std::set&lt;LXtItemType&gt;::iterator  sit;

                if (!is_valid)
                        ValidateTypeSet ();

                for (sit = cur_types.begin(); sit != cur_types.end(); sit++)
                        if (srv_scene.ItemTypeTest (*sit, type) == LXe_TRUE)
                                return true;

                return false;
        }
};
</pre></div>
</td></tr></table></div>
<p>The selection tracker class keeps track of when item selection changes and takes care of building a list of unique item types for the current state. It’s also in charge of enumeration, which is why we have a vistor class.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="k">class</span> <span class="nc">CInstSourceCommand</span> <span class="p">:</span> <span class="n">public</span> <span class="n">CLxBasicCommand</span>
 <span class="p">{</span>
    <span class="n">public</span><span class="p">:</span>
         <span class="n">CInstSourceCommand</span> <span class="p">();</span>
        <span class="o">~</span><span class="n">CInstSourceCommand</span> <span class="p">();</span>

        <span class="nb">int</span>             <span class="n">basic_CmdFlags</span>  <span class="p">()</span> <span class="n">LXx_OVERRIDE</span><span class="p">;</span>
        <span class="nb">bool</span>            <span class="n">basic_Notifier</span>  <span class="p">(</span><span class="nb">int</span> <span class="n">index</span><span class="p">,</span> <span class="n">std</span><span class="p">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">name</span><span class="p">,</span> <span class="n">std</span><span class="p">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">args</span><span class="p">)</span> <span class="n">LXx_OVERRIDE</span><span class="p">;</span>
        <span class="nb">bool</span>            <span class="n">basic_Enable</span>    <span class="p">(</span><span class="n">CLxUser_Message</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span> <span class="n">LXx_OVERRIDE</span><span class="p">;</span>

        <span class="n">CLxDynamicUIValue</span> <span class="o">*</span>
                        <span class="n">atrui_UIValue</span>   <span class="p">(</span><span class="n">unsigned</span> <span class="nb">int</span> <span class="n">index</span><span class="p">);</span>

        <span class="n">void</span>            <span class="n">cmd_Execute</span>     <span class="p">(</span><span class="n">unsigned</span> <span class="nb">int</span> <span class="n">flags</span><span class="p">)</span> <span class="n">LXx_OVERRIDE</span><span class="p">;</span>
        <span class="n">LxResult</span>        <span class="n">cmd_Query</span>       <span class="p">(</span><span class="n">unsigned</span> <span class="nb">int</span> <span class="n">index</span><span class="p">,</span> <span class="n">ILxUnknownID</span> <span class="n">vaQuery</span><span class="p">)</span> <span class="n">LXx_OVERRIDE</span><span class="p">;</span>
 <span class="p">};</span>
</pre></div>
</td></tr></table></div>
<p>The ‘instance.source’ command has the usual collection of basic methods, plus a method for customizing argument UI.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="k">class</span> <span class="nc">CEnableItemVisitor</span> <span class="p">:</span> <span class="n">public</span> <span class="n">CItemVisitor</span>
 <span class="p">{</span>
    <span class="n">public</span><span class="p">:</span>
        <span class="nb">bool</span>             <span class="nb">any</span><span class="p">;</span>

        <span class="nb">bool</span> <span class="n">Item</span> <span class="p">(</span><span class="n">CLxUser_Item</span> <span class="o">&amp;</span><span class="n">item</span><span class="p">)</span>
        <span class="p">{</span>
                <span class="nb">any</span> <span class="o">=</span> <span class="n">true</span><span class="p">;</span>
                <span class="k">return</span> <span class="n">true</span><span class="p">;</span>
        <span class="p">}</span>
 <span class="p">};</span>
</pre></div>
</td></tr></table></div>
<p>Enable – test if there’s anything selected.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CQueryItemVisitor</span> <span class="p">:</span> <span class="n">public</span> <span class="n">CItemVisitor</span>
<span class="p">{</span>
    <span class="n">public</span><span class="p">:</span>
        <span class="n">CLxUser_ValueArray</span>       <span class="n">va</span><span class="p">;</span>

        <span class="nb">bool</span> <span class="n">Item</span> <span class="p">(</span><span class="n">CLxUser_Item</span> <span class="o">&amp;</span><span class="n">item</span><span class="p">)</span>
        <span class="p">{</span>
                <span class="n">CLxUser_Value</span>            <span class="n">val</span><span class="p">;</span>
                <span class="n">CLxUser_ValueReference</span>   <span class="n">ref</span><span class="p">;</span>
                <span class="n">LXtObjectID</span>              <span class="n">src</span><span class="p">;</span>

                <span class="n">va</span><span class="o">.</span><span class="n">AddEmpty</span> <span class="p">(</span><span class="n">val</span><span class="p">);</span>
                <span class="n">ref</span><span class="o">.</span><span class="n">set</span> <span class="p">(</span><span class="n">val</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">LXx_OK</span> <span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">Source</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">src</span><span class="p">)))</span>
                        <span class="n">ref</span><span class="o">.</span><span class="n">SetObject</span> <span class="p">((</span><span class="n">ILxUnknownID</span><span class="p">)</span> <span class="n">src</span><span class="p">);</span>

                <span class="k">return</span> <span class="n">false</span><span class="p">;</span>
        <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</td></tr></table></div>
<p>Query – return a list of all selected item’s source items. This is a value reference datatype so it allows for ‘none’.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="k">class</span> <span class="nc">CItemPopup</span> <span class="p">:</span> <span class="n">public</span> <span class="n">CLxDynamicUIValue</span>
 <span class="p">{</span>
    <span class="n">public</span><span class="p">:</span>
        <span class="n">unsigned</span>        <span class="n">Flags</span> <span class="p">()</span>
                        <span class="n">LXx_OVERRIDE</span>
        <span class="p">{</span>
                <span class="k">return</span> <span class="n">LXfVALHINT_ITEMS</span> <span class="o">|</span> <span class="n">LXfVALHINT_ITEMS_NONE</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nb">bool</span>            <span class="n">ItemTest</span> <span class="p">(</span><span class="n">CLxUser_Item</span> <span class="o">&amp;</span><span class="n">item</span><span class="p">)</span>
                        <span class="n">LXx_OVERRIDE</span>
        <span class="p">{</span>
                <span class="k">return</span> <span class="n">sT</span><span class="o">-&gt;</span><span class="n">AllowType</span> <span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">Type</span> <span class="p">());</span>
        <span class="p">}</span>
 <span class="p">};</span>
</pre></div>
</td></tr></table></div>
<p>Customize the item popup. We use the selection tracker to tell us if the item should be part of the item popup. Also, we want a ‘none’ item choice.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CExecItemVisitor</span> <span class="p">:</span> <span class="n">public</span> <span class="n">CItemVisitor</span>
<span class="p">{</span>
    <span class="n">public</span><span class="p">:</span>
        <span class="n">CLxUser_Item</span>             <span class="n">set_to</span><span class="p">;</span>
        <span class="n">const</span> <span class="n">char</span>              <span class="o">*</span><span class="n">set_id</span><span class="p">;</span>
        <span class="nb">int</span>                      <span class="n">n_total</span><span class="p">,</span> <span class="n">n_fail</span><span class="p">;</span>

        <span class="nb">bool</span> <span class="n">Item</span> <span class="p">(</span><span class="n">CLxUser_Item</span> <span class="o">&amp;</span><span class="n">item</span><span class="p">)</span>
        <span class="p">{</span>
                <span class="n">LxResult</span>         <span class="n">rc</span><span class="p">;</span>
                <span class="n">const</span> <span class="n">char</span>      <span class="o">*</span><span class="nb">id</span><span class="p">;</span>

                <span class="n">n_total</span> <span class="o">++</span><span class="p">;</span>
                <span class="n">rc</span> <span class="o">=</span> <span class="n">LXe_FAILED</span><span class="p">;</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">set_to</span><span class="o">.</span><span class="n">test</span> <span class="p">())</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">set_to</span><span class="o">.</span><span class="n">IsA</span> <span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">Type</span> <span class="p">()))</span> <span class="p">{</span>
                                <span class="n">item</span><span class="o">.</span><span class="n">Ident</span> <span class="p">(</span><span class="o">&amp;</span><span class="nb">id</span><span class="p">);</span>
                                <span class="k">if</span> <span class="p">(</span><span class="nb">id</span> <span class="o">!=</span> <span class="n">set_id</span><span class="p">)</span>
                                        <span class="n">rc</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">SetSource</span> <span class="p">(</span><span class="n">set_to</span><span class="p">);</span>
                        <span class="p">}</span>
                <span class="p">}</span> <span class="k">else</span>
                        <span class="n">rc</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">SetSource</span> <span class="p">(</span><span class="mi">0</span><span class="p">);</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">LXx_FAIL</span> <span class="p">(</span><span class="n">rc</span><span class="p">))</span>
                        <span class="n">n_fail</span> <span class="o">++</span><span class="p">;</span>

                <span class="k">return</span> <span class="n">false</span><span class="p">;</span>
        <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</td></tr></table></div>
<p>Execute – this changes the source item for all selected items, or at least tries to. There are many possible reasons for failure, including the fact that this is the item itself.</p>
</div>
<div class="section" id="id2">
<h4><a class="toc-backref" href="#id14"><span class="xref std std-doc">./Initialize_(index)</span></a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">init_InstanceSource</span> <span class="p">()</span>
<span class="p">{</span>
        <span class="n">CLxGenericPolymorph</span>     <span class="o">*</span><span class="n">srv</span><span class="p">;</span>

        <span class="n">srv</span> <span class="o">=</span> <span class="n">new</span> <span class="n">CLxPolymorph</span><span class="o">&lt;</span><span class="n">CInstSourceCommand</span><span class="o">&gt;</span><span class="p">;</span>
        <span class="n">srv</span><span class="o">-&gt;</span><span class="n">AddInterface</span> <span class="p">(</span><span class="n">new</span> <span class="n">CLxIfc_Command</span>     <span class="o">&lt;</span><span class="n">CInstSourceCommand</span><span class="o">&gt;</span><span class="p">);</span>
        <span class="n">srv</span><span class="o">-&gt;</span><span class="n">AddInterface</span> <span class="p">(</span><span class="n">new</span> <span class="n">CLxIfc_Attributes</span>  <span class="o">&lt;</span><span class="n">CInstSourceCommand</span><span class="o">&gt;</span><span class="p">);</span>
        <span class="n">srv</span><span class="o">-&gt;</span><span class="n">AddInterface</span> <span class="p">(</span><span class="n">new</span> <span class="n">CLxIfc_AttributesUI</span><span class="o">&lt;</span><span class="n">CInstSourceCommand</span><span class="o">&gt;</span><span class="p">);</span>
        <span class="n">lx</span><span class="p">::</span><span class="n">AddServer</span> <span class="p">(</span><span class="s2">&quot;instance.source&quot;</span><span class="p">,</span> <span class="n">srv</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Setup our command as a server. It has a command interface, an attributes interface for arguments, and an attributesUI interface.</p>
</div>
<div class="section" id="id3">
<h4><a class="toc-backref" href="#id15">Helper Functions</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="n">static</span> <span class="n">CItemSelectionTracker</span>   <span class="o">*</span><span class="n">sT</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</td></tr></table></div>
<p>We only need one selection tracker for however many instances of commands, so we keep a count.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span></span>       <span class="n">void</span>
<span class="n">SelTrack_Acquire</span> <span class="p">(</span><span class="n">void</span><span class="p">)</span>
<span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sT</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">sT</span><span class="o">-&gt;</span><span class="n">use_count</span><span class="o">++</span><span class="p">;</span>
                <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">CLxUser_ListenerService</span>  <span class="n">ls</span><span class="p">;</span>

        <span class="n">sT</span> <span class="o">=</span> <span class="n">new</span> <span class="n">CItemSelectionTracker</span><span class="p">;</span>
        <span class="n">ls</span><span class="o">.</span><span class="n">AddListener</span> <span class="p">(</span><span class="o">*</span><span class="n">sT</span><span class="p">);</span>
<span class="p">}</span>

        <span class="n">void</span>
<span class="n">SelTrack_Release</span> <span class="p">(</span><span class="n">void</span><span class="p">)</span>
<span class="p">{</span>
        <span class="n">sT</span><span class="o">-&gt;</span><span class="n">use_count</span><span class="o">--</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sT</span><span class="o">-&gt;</span><span class="n">use_count</span><span class="p">)</span>
                <span class="k">return</span><span class="p">;</span>

        <span class="n">CLxUser_ListenerService</span>  <span class="n">ls</span><span class="p">;</span>

        <span class="n">ls</span><span class="o">.</span><span class="n">RemoveListener</span> <span class="p">(</span><span class="o">*</span><span class="n">sT</span><span class="p">);</span>
        <span class="n">delete</span> <span class="n">sT</span><span class="p">;</span>
        <span class="n">sT</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>These functions add and release selection trackers.</p>
</div>
<div class="section" id="id4">
<h4><a class="toc-backref" href="#id16">Implementations</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="n">CInstSourceCommand</span><span class="p">::</span><span class="n">CInstSourceCommand</span> <span class="p">()</span>
 <span class="p">{</span>
        <span class="n">dyna_Add</span> <span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="s2">&quot;&amp;item&quot;</span><span class="p">);</span>
        <span class="n">basic_SetFlags</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">LXfCMDARG_QUERY</span><span class="p">);</span>

        <span class="n">SelTrack_Acquire</span> <span class="p">();</span>
 <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>This constructor adds an argument of the type &amp;item and the name source as well as adding a selection tracker.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="n">CInstSourceCommand</span><span class="p">::</span><span class="o">~</span><span class="n">CInstSourceCommand</span> <span class="p">()</span>
 <span class="p">{</span>
        <span class="n">SelTrack_Release</span> <span class="p">();</span>
 <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>The destructor releases our current selection tracker.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="n">CInstSourceCommand</span><span class="p">::</span><span class="n">basic_CmdFlags</span> <span class="p">()</span>
 <span class="p">{</span>
        <span class="k">return</span> <span class="n">LXfCMD_MODEL</span> <span class="o">|</span> <span class="n">LXfCMD_UNDO</span><span class="p">;</span>
 <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>The CmdFlags function indicates that our command makes changes to the model in Modo and support undo.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span>        <span class="nb">bool</span>
 <span class="n">CInstSourceCommand</span><span class="p">::</span><span class="n">basic_Notifier</span> <span class="p">(</span>
        <span class="nb">int</span>                      <span class="n">index</span><span class="p">,</span>
        <span class="n">std</span><span class="p">::</span><span class="n">string</span>             <span class="o">&amp;</span><span class="n">name</span><span class="p">,</span>
        <span class="n">std</span><span class="p">::</span><span class="n">string</span>             <span class="o">&amp;</span><span class="n">args</span><span class="p">)</span>
 <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;select.event&quot;</span><span class="p">;</span>
                <span class="n">args</span> <span class="o">=</span> <span class="s2">&quot;item +v&quot;</span><span class="p">;</span>               <span class="o">//</span> <span class="n">VALUE</span> <span class="n">on</span> <span class="n">item</span> <span class="n">selection</span>

        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;select.event&quot;</span><span class="p">;</span>
                <span class="n">args</span> <span class="o">=</span> <span class="s2">&quot;item exist+d&quot;</span><span class="p">;</span>          <span class="o">//</span> <span class="n">DISABLE</span> <span class="n">on</span> <span class="n">item</span> <span class="n">selection</span> <span class="n">existence</span>

        <span class="p">}</span> <span class="k">else</span>
                <span class="k">return</span> <span class="n">false</span><span class="p">;</span>

        <span class="k">return</span> <span class="n">true</span><span class="p">;</span>
 <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>This function checks for if an item is currently selected or not; if one is, the command is disabled.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span>         <span class="nb">bool</span>
 <span class="n">CInstSourceCommand</span><span class="p">::</span><span class="n">basic_Enable</span> <span class="p">(</span>
        <span class="n">CLxUser_Message</span>         <span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span>
 <span class="p">{</span>
        <span class="n">CEnableItemVisitor</span>       <span class="n">vis</span><span class="p">;</span>

        <span class="n">vis</span><span class="o">.</span><span class="n">any</span> <span class="o">=</span> <span class="n">false</span><span class="p">;</span>
        <span class="n">sT</span><span class="o">-&gt;</span><span class="n">Enumerate</span> <span class="p">(</span><span class="n">vis</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">vis</span><span class="o">.</span><span class="n">any</span><span class="p">;</span>
 <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Accesses the methods created by the CEnableItemVisitor class to see if an item is currently selected or not.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span>        <span class="n">LxResult</span>
<span class="n">CInstSourceCommand</span><span class="p">::</span><span class="n">cmd_Query</span> <span class="p">(</span>
        <span class="n">unsigned</span> <span class="nb">int</span>             <span class="n">index</span><span class="p">,</span>
        <span class="n">ILxUnknownID</span>             <span class="n">vaQuery</span><span class="p">)</span>
<span class="p">{</span>
        <span class="n">CQueryItemVisitor</span>        <span class="n">vis</span><span class="p">;</span>

        <span class="n">vis</span><span class="o">.</span><span class="n">va</span><span class="o">.</span><span class="n">set</span> <span class="p">(</span><span class="n">vaQuery</span><span class="p">);</span>
        <span class="n">sT</span><span class="o">-&gt;</span><span class="n">Enumerate</span> <span class="p">(</span><span class="n">vis</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">LXe_OK</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Accesses the methods created by the CQueryItemVisitor class to return a list of all selected item’s source items.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>        <span class="n">CLxDynamicUIValue</span> <span class="o">*</span>
<span class="n">CInstSourceCommand</span><span class="p">::</span><span class="n">atrui_UIValue</span> <span class="p">(</span>
        <span class="n">unsigned</span> <span class="nb">int</span>             <span class="n">index</span><span class="p">)</span>
<span class="p">{</span>
        <span class="k">return</span> <span class="n">new</span> <span class="n">CItemPopup</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Accesses the CItemPopup methods to customize the item popup.</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Creating%20a%20Selection%20Set.html" class="btn btn-neutral float-right" title="Creating a Selection Set" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Colormodel%20kelvin.html" class="btn btn-neutral float-left" title="Colormodel kelvin" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Foundry

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org/">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>

<!-- Mirrored from learn.foundry.com/modo/developers/latest/sdk/pages/tutorials/Command VertValue.html by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 30 Nov 2024 03:16:03 GMT -->
</html>